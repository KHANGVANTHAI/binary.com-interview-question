---
title: "<img src='www/binary-logo-resize.jpg' width='240'>"
subtitle: "[<span style='color:blue'>binary.com</span>](https://github.com/englianhu/binary.com-interview-question) Interview Question I (Extention)"
author: "[®γσ, Lian Hu](https://englianhu.github.io/) <img src='www/ENG.jpg' width='24'> <img src='www/RYO.jpg' width='24'>®"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: yes
    toc_depth: 4
    number_sections: true
    toc_float:
      collapsed: false
      smooth_scroll: false
  tufte::tufte_html:
    toc: yes
    toc_depth: 4
    self_contained: no
  tufte::tufte_book:
    citation_package: natbib
    latex_engine: xelatex
  tufte::tufte_handout:
    citation_package: natbib
    latex_engine: xelatex
link-citations: yes
---

```{r setup, include=FALSE}
#'@ rm(list = ls(all = TRUE))

## load chunks `saveQ1E`.
#'@ load('./Q1E.RData')
load('./Q1E-read-data3.RData')

suppressPackageStartupMessages(library('BBmisc'))
pkgs <- c('knitr', 'kableExtra', 'tint', 'devtools', 'lubridate', 'data.table', 'plyr', 'stringr', 'magrittr', 'dplyr', 'tidyr', 'tidyverse', 'ff', 'ffbase', 'tidyquant', 'sparklyr', 'readr', 'quantmod', 'htmltools', 'highcharter', 'googleVis', 'formattable', 'ggfortify', 'DT', 'forecast', 'Mcomp', 'MCMCpack', 'PerformanceAnalytics', 'broom', 'microbenchmark', 'doParallel', 'Boruta', 'fBasics', 'fPortfolio', 'rugarch', 'parma', 'rmgarch')
 
suppressAll(lib(pkgs))
#'@ install.packages(pkgs, lib = 'C:/Program Files/R/R-3.4.0/library')

suppressAll(l_ply(c('last.R', 'Mn.R', 'has.Mn.R', 'simAutoArima.R', 'simAutoArima2.R', 'simETS.R', 'simETS2.R', 'plotChart2.R', 'armaSearch.R', 'simGarch.R', 'simGarch2.R', 'quantitative-finance.R'), function(pkg) source(paste0('./function/', pkg))))

## Set option to below if you want to plot an independent webpage with graph 
#'@ op <- options(gvis.plot.tag=NULL)
op <- options(gvis.plot.tag = 'chart')
options(gvis.plot.tag = 'chart', warn = -1)
#'@ options(rpubs.upload.method = 'internal')

## R: llply fully reproducible results in parallel
## https://stackoverflow.com/questions/34946177/r-llply-fully-reproducible-results-in-parallel
cl <- makeCluster(detectCores())
registerDoParallel(cl)

## Create a cluster object to be used for rugarcgh and rmgarch models.
cluster = makePSOCKcluster(15)

## Connect to Spark.
#'@ spark_install()
#'@ sc <- spark_connect(master = 'local')

rm(pkgs)
```

# Introduction

  By refer to *Ryo Eng Lian Hu (2017)*^[reference paper 1], I tried to compare few models for financial trading. Today I am using <s>1 minute, 3 minutes, 5 minutes, 10 minutes, 15 minutes, 30 minutes, 1 hour and also daily data instead of</s>^[Since the datasets contain few observation within a minute and also some data time period empty more than 30 minutes. Test all time period but eventually error...] only daily data. By the way, I try to compare the accuracy of forecasting instead of invesmnent.
  
  Besides, this paper will modelling multivariate Garch compare to previous paper which applied univariate Garch models.

# Data

  I select the data from 2013-01-01 to 2017-08-31^[Only get 2013-01-01 to 2017-05-15 in csv format data.] via [**the Bonnot Gang** *1 Minute Historical Data Download*](http://thebonnotgang.com/tbg/historical-data/)^[Note: The CSV file is using ; (semicolon) as a separator and , (comma) as a decimal separator.].

```{r read-data, eval=FALSE, include=FALSE}
curr <- c('USDJPY', 'USDEUR', 'USDGBP', 'USDAUD', 'USDCAD', 'USDCHF')
prd <- paste0(1:1500, 'd')

curr.minute <- llply(curr[], function(cr) {
  llply(prd, function(dy) {
    f.get.google.intraday(cr, 60, dy)
  }) %>% do.call(rbind, .)
  curr.minute$High <- curr.minute$Open
  curr.minute$Low <- curr.minute$Open
  curr.minute$Close <- curr.minute$Open
})
names(curr.minute) <- curr

saveRDS(curr.minute, './data/USDJPY.Minute.rds')
USDJPY.Minute3 <- to.minutes3(USDJPY.Minute)
```

```{python, eval=FALSE, include=FALSE}
#!/usr/bin/env python 
"""
Retrieve intraday stock data from Google Finance.
"""
# https://gist.github.com/lebedov/f09030b865c4cb142af1

import './function/get_google_finance_intraday.py'
```

```{r read-data2, eval=FALSE, include=FALSE}
## Download the datasets from http://thebonnotgang.com/tbg/historical-data/ (2013-01-01 to 2017-08-31)
fls <- dir('./data', pattern = 'USD+.+.csv') %>% str_replace_all('_1m.csv', '')

mbase <- llply(fls, function(fl) {
  #'@ z = spark_read_csv(sc, path = paste0('./data/', fl), sep = ';') %>% dplyr::tbl_df %>% 
  z = data.table::fread(paste0('./data/', fl, '_1m.csv')) %>% dplyr::tbl_df %>% dplyr::select(symbol, timestamp, close) %>% 
    mutate(Symbol = factor(symbol), 
      #'@ Date = lubridate::ymd_hms(timestamp), 
      #'@ Date = as.POSIXct(strptime(timestamp, "%Y-%m-%d %H:%M:%S")), #filter as minute as the smallest unit
      Date = as.POSIXct(strptime(timestamp, "%Y-%m-%d %H:%M")), 
      Close = as.numeric(stringr::str_replace_all(close, ',', '.')))
  z$symbol = NULL
  z$timestamp = NULL
  z$close = NULL
  names(z) = c('Symbol' , 'Date', paste0(unique(z$Symbol), c('.Close'))) #only get closing price
  z$Symbol = NULL
  #'@ z$Date = z$Date %>% stringr::str_replace_all(':[0-9]{2}$', '') %>% 
  #'@   lubridate::ymd_hm
  z %<>% unique
  z = xts(z[, -1], order.by = z$Date) %>% to.minutes
  
  ## Create a column which contain the "first date 00:00:00" until the "last date time".
  tmp = xts(, seq.POSIXt(
    from = as.POSIXct(strptime(index(z)[1], '%Y-%m-%d')), 
    to = as.POSIXct(strptime(xts::last(index(z)), '%Y-%m-%d %H:%M')), by = 'mins'))
  res = cbind(tmp, z) #cbind() will be faster than merge()
  res = na.locf(res)
  
  #'@ satsun = sort(c(seq(as.Date('2013-01-05'), as.Date('2017-08-31'), by = 7), 
  #'@                 seq(as.Date('2013-01-06'), as.Date('2017-08-31'), by = 7)))
  
  na.omit(res)
  
  })#, .parallel = TRUE)

names(mbase) <- fls %>% str_replace_all('_1m.csv', '')
```

```{r read-data3, eval=FALSE, include=FALSE}
## Due to minutes nor hours dataset not completed and always happen error, here only read daily data but not minutes, hours etc.
fls <- dir('./data', pattern = 'USD+.+.csv') %>% str_replace_all('_1m.csv', '')

mbase <- llply(fls, function(fl) {
    #'@ z = spark_read_csv(sc, path = paste0('./data/', fl), sep = ';') %>% dplyr::tbl_df %>% 
    z = data.table::fread(paste0('./data/', fl, '_1m.csv')) %>% dplyr::tbl_df %>% dplyr::select(symbol, timestamp, close) %>% 
        mutate(Symbol = factor(symbol), Date = lubridate::ymd_hms(timestamp), 
               Close = as.numeric(stringr::str_replace_all(close, ',', '.')))
    z$symbol = NULL
    z$timestamp = NULL
    z$close = NULL
    names(z) = c('Symbol' , 'Date', paste0(unique(z$Symbol), c('.Close'))) #only get closing price
    z$Symbol = NULL
    z$Date %<>% stringr::str_replace_all(':[0-9]{2}$', '') %>% 
      lubridate::ymd_hm
    z %<>% unique
    xts(z[, -1], order.by = z$Date)
    })
names(mbase) <- fls %>% str_replace_all('_1m.csv', '')

## Save read-data2 dataset.
save.image('./Q1E-read-data3.RData')
```

```{r get-yahooData, eval=FALSE, include=FALSE}
## Due to minutes nor hours dataset not completed and always happen error, here only read daily data but not minutes, hours etc.
library(quantmod)
getSymbols('AUD=X', src = 'yahoo', from = '2012-01-01', to = '2017-08-31')
getSymbols('EUR=X', src = 'yahoo', from = '2012-01-01', to = '2017-08-31')
getSymbols('GBP=X', src = 'yahoo', from = '2012-01-01', to = '2017-08-31')
getSymbols('CAD=X', src = 'yahoo', from = '2012-01-01', to = '2017-08-31')
getSymbols('CHF=X', src = 'yahoo', from = '2012-01-01', to = '2017-08-31')
getSymbols('CNY=X', src = 'yahoo', from = '2012-01-01', to = '2017-08-31')
getSymbols('JPY=X', src = 'yahoo', from = '2012-01-01', to = '2017-08-31')

USDAUD <- `AUD=X` %>% na.omit; rm(`AUD=X`)
USDEUR <- `EUR=X` %>% na.omit; rm(`EUR=X`)
USDGBP <- `GBP=X` %>% na.omit; rm(`GBP=X`)
USDCAD <- `CAD=X` %>% na.omit; rm(`CAD=X`)
USDCHF <- `CHF=X` %>% na.omit; rm(`CHF=X`)
USDCNY <- `CNY=X` %>% na.omit; rm(`CNY=X`)
USDJPY <- `JPY=X` %>% na.omit; rm(`JPY=X`)

names(USDAUD) <- names(USDAUD) %>% str_replace_all('AUD=X', 'USDAUD')
names(USDEUR) <- names(USDEUR) %>% str_replace_all('EUR=X', 'USDEUR')
names(USDGBP) <- names(USDGBP) %>% str_replace_all('GBP=X', 'USDGBP')
names(USDCAD) <- names(USDCAD) %>% str_replace_all('CAD=X', 'USDCAD')
names(USDCHF) <- names(USDCHF) %>% str_replace_all('CHF=X', 'USDCHF')
names(USDCNY) <- names(USDCNY) %>% str_replace_all('CNY=X', 'USDCNY')
names(USDJPY) <- names(USDJPY) %>% str_replace_all('JPY=X', 'USDJPY')

## Save yahooData dataset.
saveRDS(USDAUD, './data/USDAUD.rds')
saveRDS(USDEUR, './data/USDEUR.rds')
saveRDS(USDGBP, './data/USDGBP.rds')
saveRDS(USDCAD, './data/USDCAD.rds')
saveRDS(USDCHF, './data/USDCHF.rds')
saveRDS(USDCNY, './data/USDCNY.rds')
saveRDS(USDJPY, './data/USDJPY.rds')
```

```{r dateID, eval=FALSE, include=FALSE}
## dateID
#'@ dateID <- llply(mbase, function(x) index(x) %>% as.character) %>% 
#'@   unlist %>% unique %>% stringr::str_replace_all(':[0-9]{2}$', '') %>% 
#'@   lubridate::ymd_hm %>% sort

#'@ dateID <- llply(mbase, function(x) index(x) %>% as.character) %>% 
#'@   unlist %>% unique %>% lubridate::ymd_hms %>% sort

#'@ dateID <- llply(mbase, function(x) index(x) %>% as.character) %>% unlist %>% unique
#'@ dateID <- as.POSIXct(strptime(dateID, "%Y-%m-%d %H:%M")) %>% sort
#'@ dateID0 <- ymd('2014-01-01')
#'@ dateID <- dateID[dateID > dateID0]
```

```{r saveQ1E, eval=FALSE, include=FALSE}
## Save read-data2 dataset.
save.image('./Q1E.RData')
```

```{r data-summ, warning=FALSE, echo=FALSE}
##  1 minute
mbase_min1 <- mbase
#'@ mbase_min1 <- llply(mbase, function(x) {
#'@   z = to.minutes(x)
#'@   nn = names(x) %>% str_replace_all('.Close', '')
#'@   names(z) = names(z) %>% str_replace_all('x', nn)
#'@   z})

##  3 minutes
mbase_min3 <- llply(mbase, function(x) {
  z = to.minutes3(x)
  nn = names(x) %>% str_replace_all('.Close', '')
  names(z) = names(z) %>% str_replace_all('x', nn)
  z})

##  5 minutes
mbase_min5 <- llply(mbase, function(x) {
  z = to.minutes5(x)
  nn = names(x) %>% str_replace_all('.Close', '')
  names(z) = names(z) %>% str_replace_all('x', nn)
  z})

##  10 minutes
mbase_min10 <- llply(mbase, function(x) {
  z = to.minutes10(x)
  nn = names(x) %>% str_replace_all('.Close', '')
  names(z) = names(z) %>% str_replace_all('x', nn)
  z})

##  15 minutes
mbase_min15 <- llply(mbase, function(x) {
  z = to.minutes15(x)
  nn = names(x) %>% str_replace_all('.Close', '')
  names(z) = names(z) %>% str_replace_all('x', nn)
  z})

##  30 minutes
mbase_min30 <- llply(mbase, function(x) {
  z = to.minutes30(x)
  nn = names(x) %>% str_replace_all('.Close', '')
  names(z) = names(z) %>% str_replace_all('x', nn)
  z})

##  1 hour
mbase_hrs1 <- llply(mbase, function(x) {
  z = to.hourly(x)
  nn = names(x) %>% str_replace_all('.Close', '')
  names(z) = names(z) %>% str_replace_all('x', nn)
  z})

##  1 day
mbase_day1 <- llply(mbase, function(x) {
  #'@ z %<>% mutate(Date = as.POSIXct(strptime(Date, "%Y-%m-%d %H")))
  z = to.daily(x)
  nn = names(x) %>% str_replace_all('.Close', '')
  names(z) = names(z) %>% str_replace_all('x', nn)
  z})

#'@ fx <- ldply(mbase, dim)
#'@ names(fx) <- c('Currency', 'Rows.all', 'Cols.all')
rm(mbase)

fx_1m <- ldply(mbase_min1, dim)
names(fx_1m) <- c('Currency', 'Rows.1m', 'Cols.1m')
fx_3m <- ldply(mbase_min3, dim)
names(fx_3m) <- c('Currency', 'Rows.3m', 'Cols.3m')
fx_5m <- ldply(mbase_min5, dim)
names(fx_5m) <- c('Currency', 'Rows.5m', 'Cols.5m')
fx_10m <- ldply(mbase_min10, dim)
names(fx_10m) <- c('Currency', 'Rows.10m', 'Cols.10m')
fx_15m <- ldply(mbase_min15, dim)
names(fx_15m) <- c('Currency', 'Rows.15m', 'Cols.15m')
fx_30m <- ldply(mbase_min30, dim)
names(fx_30m) <- c('Currency', 'Rows.30m', 'Cols.30m')
fx_1h <- ldply(mbase_hrs1, dim)
names(fx_1h) <- c('Currency', 'Rows.1h', 'Cols.1h')
fx_1d <- ldply(mbase_day1, dim)
names(fx_1d) <- c('Currency', 'Rows.1d', 'Cols.1d')

do.call(cbind, list(fx_1m, fx_3m, fx_5m, fx_10m, fx_15m, fx_30m, 
                    fx_1h, fx_1d)) %>% 
  kable(caption = 'Data Summary of 1min, 3mins, 5mins, 10mins, 30mins, 1hr, 1d') %>% 
  kable_styling(bootstrap_options = c('striped', 'hover', 'condensed', 'responsive')) %>%
  scroll_box(width = '100%', height = '400px')

llply(mbase_day1, summary)
```

  Due to the dataset always happened errors and not completed somemore wrong figures, here I get the daily data from 2012-01-01 to 2017-08-31 via Yahoo. However only take the data from 2014-01-01 to 2017-08-31 as experiments.

```{r read-yahooData}
## Read yahooData dataset.
USDAUD <- readRDS('./data/USDAUD.rds')
USDEUR <- readRDS('./data/USDEUR.rds')
USDGBP <- readRDS('./data/USDGBP.rds')
USDCAD <- readRDS('./data/USDCAD.rds')
USDCHF <- readRDS('./data/USDCHF.rds')
USDCNY <- readRDS('./data/USDCNY.rds')
USDJPY <- readRDS('./data/USDJPY.rds')

mbase <- list(USDAUD = USDAUD, USDEUR = USDEUR, USDGBP = USDGBP, 
              USDCAD = USDCAD, USDCHF = USDCHF, USDCNY = USDCNY, 
              USDJPY = USDJPY)
rm(USDAUD, USDEUR, USDGBP, USDCAD, USDCHF, USDCNY, USDJPY)

llply(mbase, summary)
```

# Statiscal Modelling

## Auto Arima Models

```{r sparklyr, eval=FALSE, include=FALSE}
## http://bigdata-madesimple.com/tools-in-the-data-armoury-r-vs-spark/

> sc <- sparkR.init(master="local")
Launching java with spark-submit command spark-submit2.cmd   sparkr-shell C:\Users\scibr\AppData\Local\Temp\RtmpOI78eA\backend_port1f7051615e1b 
Error in sparkR.sparkContext(master, appName, sparkHome, convertNamedListToEnv(sparkEnvir),  : 
  JVM is not ready after 10 seconds
In addition: Warning message:
'sparkR.init' is deprecated.
Use 'sparkR.session' instead.
See help("Deprecated") 
> library(sparklyr)
> sc <- spark_connect(master = "local")
* Using Spark: 2.1.0
Error in get_java(throws = TRUE) : 
  Java is required to connect to Spark. JAVA_HOME is set but does not point to a valid version. Please fix JAVA_HOME or reinstall from: https://www.java.com/en/
```

```{r minute1-AutoArima, eval=FALSE, include=FALSE}
## Using closing price to forecast.
#'@ source('./function/AutoArima.min1.R')
AUDUSD.AutoArima.min1 <- readRDS('./data/AUDUSD.AutoArima.min1.rds')
EURUSD.AutoArima.min1 <- readRDS('./data/EURUSD.AutoArima.min1.rds')
GBPUSD.AutoArima.min1 <- readRDS('./data/GBPUSD.AutoArima.min1.rds')
USDCAD.AutoArima.min1 <- readRDS('./data/USDCAD.AutoArima.min1.rds')
USDCHF.AutoArima.min1 <- readRDS('./data/USDCHF.AutoArima.min1.rds')
USDCNY.AutoArima.min1 <- readRDS('./data/USDCNY.AutoArima.min1.rds')
USDJPY.AutoArima.min1 <- readRDS('./data/USDJPY.AutoArima.min1.rds')
```

```{r minute3-AutoArima, eval=FALSE, include=FALSE}
## Using closing price to forecast.
#'@ source('./function/AutoArima.min3.R')
AUDUSD.AutoArima.min3 <- readRDS('./data/AUDUSD.AutoArima.min3.rds')
EURUSD.AutoArima.min3 <- readRDS('./data/EURUSD.AutoArima.min3.rds')
GBPUSD.AutoArima.min3 <- readRDS('./data/GBPUSD.AutoArima.min3.rds')
USDCAD.AutoArima.min3 <- readRDS('./data/USDCAD.AutoArima.min3.rds')
USDCHF.AutoArima.min3 <- readRDS('./data/USDCHF.AutoArima.min3.rds')
USDCNY.AutoArima.min3 <- readRDS('./data/USDCNY.AutoArima.min3.rds')
USDJPY.AutoArima.min3 <- readRDS('./data/USDJPY.AutoArima.min3.rds')
```

```{r minute5-AutoArima, eval=FALSE, include=FALSE}
## Using closing price to forecast.
#'@ source('./function/AutoArima.min5.R')
AUDUSD.AutoArima.min5 <- readRDS('./data/AUDUSD.AutoArima.min5.rds')
EURUSD.AutoArima.min5 <- readRDS('./data/EURUSD.AutoArima.min5.rds')
GBPUSD.AutoArima.min5 <- readRDS('./data/GBPUSD.AutoArima.min5.rds')
USDCAD.AutoArima.min5 <- readRDS('./data/USDCAD.AutoArima.min5.rds')
USDCHF.AutoArima.min5 <- readRDS('./data/USDCHF.AutoArima.min5.rds')
USDCNY.AutoArima.min5 <- readRDS('./data/USDCNY.AutoArima.min5.rds')
USDJPY.AutoArima.min5 <- readRDS('./data/USDJPY.AutoArima.min5.rds')
```

```{r minute10-AutoArima, eval=FALSE, include=FALSE}
## Using closing price to forecast.
#'@ source('./function/AutoArima.min10.R')
AUDUSD.AutoArima.min10 <- readRDS('./data/AUDUSD.AutoArima.min10.rds')
EURUSD.AutoArima.min10 <- readRDS('./data/EURUSD.AutoArima.min10.rds')
GBPUSD.AutoArima.min10 <- readRDS('./data/GBPUSD.AutoArima.min10.rds')
USDCAD.AutoArima.min10 <- readRDS('./data/USDCAD.AutoArima.min10.rds')
USDCHF.AutoArima.min10 <- readRDS('./data/USDCHF.AutoArima.min10.rds')
USDCNY.AutoArima.min10 <- readRDS('./data/USDCNY.AutoArima.min10.rds')
USDJPY.AutoArima.min10 <- readRDS('./data/USDJPY.AutoArima.min10.rds')
```

```{r minute15-AutoArima, eval=FALSE, include=FALSE}
## Using closing price to forecast.
#'@ source('./function/AutoArima.min15.R')
AUDUSD.AutoArima.min15 <- readRDS('./data/AUDUSD.AutoArima.min15.rds')
EURUSD.AutoArima.min15 <- readRDS('./data/EURUSD.AutoArima.min15.rds')
GBPUSD.AutoArima.min15 <- readRDS('./data/GBPUSD.AutoArima.min15.rds')
USDCAD.AutoArima.min15 <- readRDS('./data/USDCAD.AutoArima.min15.rds')
USDCHF.AutoArima.min15 <- readRDS('./data/USDCHF.AutoArima.min15.rds')
USDCNY.AutoArima.min15 <- readRDS('./data/USDCNY.AutoArima.min15.rds')
USDJPY.AutoArima.min15 <- readRDS('./data/USDJPY.AutoArima.min15.rds')
```

```{r minute30-AutoArima, eval=FALSE, include=FALSE}
## Using closing price to forecast.
#'@ source('./function/AutoArima.min30.R')
AUDUSD.AutoArima.min30 <- readRDS('./data/AUDUSD.AutoArima.min30.rds')
EURUSD.AutoArima.min30 <- readRDS('./data/EURUSD.AutoArima.min30.rds')
GBPUSD.AutoArima.min30 <- readRDS('./data/GBPUSD.AutoArima.min30.rds')
USDCAD.AutoArima.min30 <- readRDS('./data/USDCAD.AutoArima.min30.rds')
USDCHF.AutoArima.min30 <- readRDS('./data/USDCHF.AutoArima.min30.rds')
USDCNY.AutoArima.min30 <- readRDS('./data/USDCNY.AutoArima.min30.rds')
USDJPY.AutoArima.min30 <- readRDS('./data/USDJPY.AutoArima.min30.rds')
```

```{r hour1-AutoArima, eval=FALSE, include=FALSE}
## Using closing price to forecast.
#'@ source('./function/AutoArima.h1.R')
AUDUSD.AutoArima.h1 <- readRDS('./data/AUDUSD.AutoArima.h1.rds')
EURUSD.AutoArima.h1 <- readRDS('./data/EURUSD.AutoArima.h1.rds')
GBPUSD.AutoArima.h1 <- readRDS('./data/GBPUSD.AutoArima.h1.rds')
USDCAD.AutoArima.h1 <- readRDS('./data/USDCAD.AutoArima.h1.rds')
USDCHF.AutoArima.h1 <- readRDS('./data/USDCHF.AutoArima.h1.rds')
USDCNY.AutoArima.h1 <- readRDS('./data/USDCNY.AutoArima.h1.rds')
USDJPY.AutoArima.h1 <- readRDS('./data/USDJPY.AutoArima.h1.rds')
```

```{r day3m-AutoArima, eval=FALSE, include=FALSE}
## Using closing price to forecast.
#'@ source('./function/AutoArima.d3m.R')
AUDUSD.AutoArima.d3m <- readRDS('./data/AUDUSD.AutoArima.d3m.rds')
EURUSD.AutoArima.d3m <- readRDS('./data/EURUSD.AutoArima.d3m.rds')
GBPUSD.AutoArima.d3m <- readRDS('./data/GBPUSD.AutoArima.d3m.rds')
USDCAD.AutoArima.d3m <- readRDS('./data/USDCAD.AutoArima.d3m.rds')
USDCHF.AutoArima.d3m <- readRDS('./data/USDCHF.AutoArima.d3m.rds')
USDCNY.AutoArima.d3m <- readRDS('./data/USDCNY.AutoArima.d3m.rds')
USDJPY.AutoArima.d3m <- readRDS('./data/USDJPY.AutoArima.d3m.rds')
```

```{r day6m-AutoArima, eval=FALSE, include=FALSE}
## Using closing price to forecast.
#'@ source('./function/AutoArima.d6m.R')
AUDUSD.AutoArima.d6m <- readRDS('./data/AUDUSD.AutoArima.d6m.rds')
EURUSD.AutoArima.d6m <- readRDS('./data/EURUSD.AutoArima.d6m.rds')
GBPUSD.AutoArima.d6m <- readRDS('./data/GBPUSD.AutoArima.d6m.rds')
USDCAD.AutoArima.d6m <- readRDS('./data/USDCAD.AutoArima.d6m.rds')
USDCHF.AutoArima.d6m <- readRDS('./data/USDCHF.AutoArima.d6m.rds')
USDCNY.AutoArima.d6m <- readRDS('./data/USDCNY.AutoArima.d6m.rds')
USDJPY.AutoArima.d6m <- readRDS('./data/USDJPY.AutoArima.d6m.rds')
```

```{r day1y-AutoArima, eval=FALSE, include=FALSE}
## Using closing price to forecast.
#'@ source('./function/AutoArima.d1y.R')
AUDUSD.AutoArima.d1y <- readRDS('./data/AUDUSD.AutoArima.d1y.rds')
EURUSD.AutoArima.d1y <- readRDS('./data/EURUSD.AutoArima.d1y.rds')
GBPUSD.AutoArima.d1y <- readRDS('./data/GBPUSD.AutoArima.d1y.rds')
USDCAD.AutoArima.d1y <- readRDS('./data/USDCAD.AutoArima.d1y.rds')
USDCHF.AutoArima.d1y <- readRDS('./data/USDCHF.AutoArima.d1y.rds')
USDCNY.AutoArima.d1y <- readRDS('./data/USDCNY.AutoArima.d1y.rds')
USDJPY.AutoArima.d1y <- readRDS('./data/USDJPY.AutoArima.d1y.rds')
```

  Below I use arima model to analyse Yahoo data.

```{r yahooAutoArima, eval=FALSE}
## Using closing price to forecast.
.baseDate = '2014-01-01 00:00:00'
.baseDate = ymd(ymd_hms(.baseDate))

## 3 months
yahooD3M <- llply(mbase, function(x) {
  z = simAutoArima(x, .prCat = 'Cl', 
                   .baseDate = .baseDate, .verbose = TRUE, 
                   .maPeriod = 'months', .unit = 3)
  nm = names(Cl(x)) %>% str_replace_all('.Close', '')
  saveRDS(z, paste0('./data/', nm, '.yahooAutoArima.d3m.rds'))
  cat(paste0('Saved... ./data/', nm, '.yahooAutoArima.d3m.rds\n'))
})


## 6 months
yahooD6M <- llply(mbase, function(x) {
  z = simAutoArima(x, .prCat = 'Cl', 
                   .baseDate = .baseDate, .verbose = TRUE, 
                   .maPeriod = 'months', .unit = 6)
  nm = names(Cl(x)) %>% str_replace_all('.Close', '')
  saveRDS(z, paste0('./data/', nm, '.yahooAutoArima.d6m.rds'))
  cat(paste0('Saved... ./data/', nm, '.yahooAutoArima.d6m.rds\n'))
})


## 1 year
yahooD1Y <- llply(mbase, function(x) {
  z = simAutoArima(x, .prCat = 'Cl', 
               .baseDate = .baseDate, .verbose = TRUE, 
               .maPeriod = 'years', .unit = 1)
  nm = names(Cl(x)) %>% str_replace_all('.Close', '')
  saveRDS(z, paste0('./data/', nm, '.yahooAutoArima.d1y.rds'))
  cat(paste0('Saved... ./data/', nm, '.yahooAutoArima.d1y.rds\n'))
  })


## 18 months
yahooD18M <- llply(mbase, function(x) {
  z = simAutoArima(x, .prCat = 'Cl', 
               .baseDate = .baseDate, .verbose = TRUE, 
               .maPeriod = 'months', .unit = 18)
  nm = names(Cl(x)) %>% str_replace_all('.Close', '')
  saveRDS(z, paste0('./data/', nm, '.yahooAutoArima.d18m.rds'))
  cat(paste0('Saved... ./data/', nm, '.yahooAutoArima.d18m.rds\n'))
  })


## 2 years
yahooD2Y <- llply(mbase, function(x) {
  z = simAutoArima(x, .prCat = 'Cl', 
               .baseDate = .baseDate, .verbose = TRUE, 
               .maPeriod = 'years', .unit = 2)
  nm = names(Cl(x)) %>% str_replace_all('.Close', '')
  saveRDS(z, paste0('./data/', nm, '.yahooAutoArima.d2y.rds'))
  cat(paste0('Saved... ./data/', nm, '.yahooAutoArima.d2y.rds\n'))
  })
```

## Exponential Smoothing Models

```{r multi-etsM, eval=FALSE, include=FALSE}
## set all models provided by ets function.
ets.m1 <- c('A', 'M', 'Z')
ets.m2 <- c('N', 'A', 'M', 'Z')
ets.m3 <- c('N', 'A', 'M', 'Z')
ets.m <- do.call(paste0, expand.grid(ets.m1, ets.m2, ets.m3))
rm(ets.m1, ets.m2, ets.m3)
```

```{r multi-ETS, eval=FALSE, include=FALSE}
## ----- Due to error, here I use simAutoArima -----------------------------
## Using closing price to forecast.
.baseDate = '2014-01-01 00:00:00'
.baseDate = ymd(ymd_hms(.baseDate))

## 3 months
res <- llply(ets.m, function(x) {
  llply(mbase_day1, function(y) {
    z = simETS(y, .model = x, .prCat = 'Cl', .baseDate = .baseDate, 
               .maPeriod = 'months', .unit = 3, .verbose = TRUE, 
               .simulate = TRUE, .bootstrap = TRUE)
	nm = names(Cl(z)) %>% str_replace_all('.Close', '')
    txt1 <- paste0('saveRDS(z', ', file = \'./data/', nm, '.', 
	               x, '.Cl.d3m.rds\'); rm(z)')
    eval(parse(text = txt1))
    cat(paste0(txt1, ' done!', '\n'))
  })
  cat(paste(x, 'done', '\n'))
})


## 6 months
res <- llply(ets.m, function(x) {
  llply(mbase_day1, function(y) {
    z = simETS(y, .model = x, .prCat = 'Cl', .baseDate = .baseDate, 
                .maPeriod = 'months', .unit = 6, .verbose = TRUE, 
                .simulate = TRUE, .bootstrap = TRUE)
    nm = names(Cl(z)) %>% str_replace_all('.Close', '')
	txt1 <- paste0('saveRDS(z', ', file = \'./data/', nm, '.', 
	               x, '.Cl.d6m.rds\'); rm(z)')
    eval(parse(text = txt1))
    cat(paste0(txt1, ' done!', '\n'))
  })
  cat(paste(x, 'done', '\n'))
})


## 1 years
res <- llply(ets.m, function(x) {
  llply(mbase_day1, function(y) {
    z = simETS(y, .model = x, .prCat = 'Cl', .baseDate = .baseDate, 
                .maPeriod = 'years', .unit = 1, .verbose = TRUE, 
                .simulate = TRUE, .bootstrap = TRUE)
    nm = names(Cl(z)) %>% str_replace_all('.Close', '')
	txt1 <- paste0('saveRDS(z', ', file = \'./data/', nm, '.', 
	               x, '.Cl.d1y.rds\'); rm(z)')
    eval(parse(text = txt1))
    cat(paste0(txt1, ' done!', '\n'))
  })
  cat(paste(x, 'done', '\n'))
})
```

```{r day3m-ETS, eval=FALSE, include=FALSE}
## Using closing price to forecast.
#'@ source('./function/ETS.d3m.R')
AUDUSD.ETS.d3m <- readRDS('./data/AUDUSD.ETS.d3m.rds')
EURUSD.ETS.d3m <- readRDS('./data/EURUSD.ETS.d3m.rds')
GBPUSD.ETS.d3m <- readRDS('./data/GBPUSD.ETS.d3m.rds')
USDCAD.ETS.d3m <- readRDS('./data/USDCAD.ETS.d3m.rds')
USDCHF.ETS.d3m <- readRDS('./data/USDCHF.ETS.d3m.rds')
USDCNY.ETS.d3m <- readRDS('./data/USDCNY.ETS.d3m.rds')
USDJPY.ETS.d3m <- readRDS('./data/USDJPY.ETS.d3m.rds')
```

```{r day6m-ETS, eval=FALSE, include=FALSE}
## Using closing price to forecast.
#'@ source('./function/ETS.d6m.R')
AUDUSD.ETS.d6m <- readRDS('./data/AUDUSD.ETS.d6m.rds')
EURUSD.ETS.d6m <- readRDS('./data/EURUSD.ETS.d6m.rds')
GBPUSD.ETS.d6m <- readRDS('./data/GBPUSD.ETS.d6m.rds')
USDCAD.ETS.d6m <- readRDS('./data/USDCAD.ETS.d6m.rds')
USDCHF.ETS.d6m <- readRDS('./data/USDCHF.ETS.d6m.rds')
USDCNY.ETS.d6m <- readRDS('./data/USDCNY.ETS.d6m.rds')
USDJPY.ETS.d6m <- readRDS('./data/USDJPY.ETS.d6m.rds')
```

```{r day1y-ETS, eval=FALSE, include=FALSE}
## Using closing price to forecast.
#'@ source('./function/ETS.d1y.R')
AUDUSD.ETS.d1y <- readRDS('./data/AUDUSD.ETS.d1y.rds')
EURUSD.ETS.d1y <- readRDS('./data/EURUSD.ETS.d1y.rds')
GBPUSD.ETS.d1y <- readRDS('./data/GBPUSD.ETS.d1y.rds')
USDCAD.ETS.d1y <- readRDS('./data/USDCAD.ETS.d1y.rds')
USDCHF.ETS.d1y <- readRDS('./data/USDCHF.ETS.d1y.rds')
USDCNY.ETS.d1y <- readRDS('./data/USDCNY.ETS.d1y.rds')
USDJPY.ETS.d1y <- readRDS('./data/USDJPY.ETS.d1y.rds')
```

  Now I analyse the Yahoo data by using Exponential Time Series Smoothing models.

```{r multi-yahooETS, eval=FALSE, include=FALSE}
## ----- Due to error, here I use simAutoArima -----------------------------
## Using closing price to forecast.
.baseDate = '2014-01-01 00:00:00'
.baseDate = ymd(ymd_hms(.baseDate))

## 3 months
res <- llply(ets.m, function(x) {
  llply(mbase, function(y) {
    z = simETS(y, .model = x, .prCat = 'Cl', .baseDate = .baseDate, 
               .maPeriod = 'months', .unit = 3, .verbose = TRUE, 
               .simulate = TRUE, .bootstrap = TRUE)
	nm = names(Cl(z)) %>% str_replace_all('.Close', '')
    txt1 <- paste0('saveRDS(z', ', file = \'./data/', nm, '.yahoo.', 
	               x, '.Cl.d3m.rds\'); rm(z)')
    eval(parse(text = txt1))
    cat(paste0(txt1, ' done!', '\n'))
  })
  cat(paste(x, 'done', '\n'))
})


## 6 months
res <- llply(ets.m, function(x) {
  llply(mbase, function(y) {
    z = simETS(y, .model = x, .prCat = 'Cl', .baseDate = .baseDate, 
                .maPeriod = 'months', .unit = 6, .verbose = TRUE, 
                .simulate = TRUE, .bootstrap = TRUE)
    nm = names(Cl(z)) %>% str_replace_all('.Close', '')
	txt1 <- paste0('saveRDS(z', ', file = \'./data/', nm, '.yahoo.', 
	               x, '.Cl.d6m.rds\'); rm(z)')
    eval(parse(text = txt1))
    cat(paste0(txt1, ' done!', '\n'))
  })
  cat(paste(x, 'done', '\n'))
})


## 1 year
res <- llply(ets.m, function(x) {
  llply(mbase, function(y) {
    z = simETS(y, .model = x, .prCat = 'Cl', .baseDate = .baseDate, 
                .maPeriod = 'years', .unit = 1, .verbose = TRUE, 
                .simulate = TRUE, .bootstrap = TRUE)
    nm = names(Cl(z)) %>% str_replace_all('.Close', '')
	txt1 <- paste0('saveRDS(z', ', file = \'./data/', nm, '.yahoo.', 
	               x, '.Cl.d1y.rds\'); rm(z)')
    eval(parse(text = txt1))
    cat(paste0(txt1, ' done!', '\n'))
  })
  cat(paste(x, 'done', '\n'))
})


## 18 months
res <- llply(ets.m, function(x) {
  llply(mbase, function(y) {
    z = simETS(y, .model = x, .prCat = 'Cl', .baseDate = .baseDate, 
                .maPeriod = 'months', .unit = 18, .verbose = TRUE, 
                .simulate = TRUE, .bootstrap = TRUE)
    nm = names(Cl(z)) %>% str_replace_all('.Close', '')
	txt1 <- paste0('saveRDS(z', ', file = \'./data/', nm, '.yahoo.', 
	               x, '.Cl.d18m.rds\'); rm(z)')
    eval(parse(text = txt1))
    cat(paste0(txt1, ' done!', '\n'))
  })
  cat(paste(x, 'done', '\n'))
})


## 2 years
res <- llply(ets.m, function(x) {
  llply(mbase, function(y) {
    z = simETS(y, .model = x, .prCat = 'Cl', .baseDate = .baseDate, 
                .maPeriod = 'years', .unit = 2, .verbose = TRUE, 
                .simulate = TRUE, .bootstrap = TRUE)
    nm = names(Cl(z)) %>% str_replace_all('.Close', '')
	txt1 <- paste0('saveRDS(z', ', file = \'./data/', nm, '.yahoo.', 
	               x, '.Cl.d2y.rds\'); rm(z)')
    eval(parse(text = txt1))
    cat(paste0(txt1, ' done!', '\n'))
  })
  cat(paste(x, 'done', '\n'))
})
```

## Univariate Garch Models and EWMA

```{r multi-garchM, eval=FALSE, include=FALSE}
## Multiple Garch models inside `rugarch` package.
.variance.model.par <- c('sGARCH', 'fGARCH', 'eGARCH', 'gjrGARCH', 'apARCH', 'iGARCH', 'csGARCH', 'realGARCH')

## set all models provided by Garch function.
.solver.par <- c('hybrid', 'solnp', 'nlminb', 'gosolnp', 'nloptr', 'lbfgs')

.sub.fGarch.par <- c('GARCH', 'TGARCH', 'AVGARCH', 'NGARCH', 'NAGARCH', 'APARCH', 'GJRGARCH', 'ALLGARCH')

.dist.model.par <- c('norm', 'snorm', 'std', 'sstd', 'ged', 'sged', 'nig', 'ghyp', 'jsu')


##Bootstrap parameters
.boot.method = c('Partial', 'Full')
.boot.solver = c('solnp', 'nlminb')
```

```{r multi-Garch, eval=FALSE, include=FALSE}
## ----- Due to error, here I use simAutoArima -----------------------------
## Using closing price to forecast.
.baseDate = '2014-01-01 00:00:00'
.baseDate = ymd(ymd_hms(.baseDate))


## 3 months
res <- llply(Garch.m, function(x) {
  llply(mbase_day1, function(y) {
    z = simGarch(y, .prCat = 'Cl', .baseDate = .baseDate, 
                 .variance.model = list(model = x, garchOrder = c(1, 1), 
                                        submodel = NULL, 
                                        external.regressors = NULL, 
                                        variance.targeting = FALSE), 
                 .maPeriod = 'months', .unit = 3, .verbose = TRUE)#, 
                 #.bootstrap = TRUE, .boot.method = 'Partial', 
    #.boot.solver = 'solnp')
    nm = names(Cl(z)) %>% str_replace_all('.Close', '')
    txt1 = paste0('saveRDS(z', ', file = \'./data/', nm, '.', 
                  x, '.hybrid.Cl.d3m.rds\'); rm(z)')
    eval(parse(text = txt1))
    cat(paste0(txt1, ' done!', '\n'))
  })
  cat(paste(x, 'done', '\n'))
})


## 6 months
res <- llply(Garch.m, function(x) {
  llply(mbase_day1, function(y) {
    z = simGarch(y, .prCat = 'Cl', .baseDate = .baseDate, 
                 .variance.model = list(model = x, garchOrder = c(1, 1), 
                                        submodel = NULL, 
                                        external.regressors = NULL, 
                                        variance.targeting = FALSE), 
                 .maPeriod = 'months', .unit = 6, .verbose = TRUE)#, 
                 #.bootstrap = TRUE, .boot.method = 'Partial', 
    #.boot.solver = 'solnp')
    nm = names(Cl(z)) %>% str_replace_all('.Close', '')
    txt1 = paste0('saveRDS(z', ', file = \'./data/', nm, '.', 
                  x, '.hybrid.Cl.d6m.rds\'); rm(z)')
    eval(parse(text = txt1))
    cat(paste0(txt1, ' done!', '\n'))
  })
  cat(paste(x, 'done', '\n'))
})


## 1 years
res <- llply(Garch.m, function(x) {
  llply(mbase_day1, function(y) {
    z = simGarch(y, .prCat = 'Cl', .baseDate = .baseDate, 
                 .variance.model = list(model = x, garchOrder = c(1, 1), 
                                        submodel = NULL, 
                                        external.regressors = NULL, 
                                        variance.targeting = FALSE), 
                 .maPeriod = 'years', .unit = 1, .verbose = TRUE)#, 
                 #.bootstrap = TRUE, .boot.method = 'Partial', 
    #.boot.solver = 'solnp')
    nm = names(Cl(z)) %>% str_replace_all('.Close', '')
    txt1 = paste0('saveRDS(z', ', file = \'./data/', nm, '.', 
                  x, '.hybrid.Cl.d1y.rds\'); rm(z)')
    eval(parse(text = txt1))
    cat(paste0(txt1, ' done!', '\n'))
  })
  cat(paste(x, 'done', '\n'))
})
```

```{r day3m-Garch, eval=FALSE}
## Using closing price to forecast.
#'@ source('./function/Garch.d3m.R')
AUDUSD.Garch.d3m <- readRDS('./data/AUDUSD.Garch.d3m.rds')
EURUSD.Garch.d3m <- readRDS('./data/EURUSD.Garch.d3m.rds')
GBPUSD.Garch.d3m <- readRDS('./data/GBPUSD.Garch.d3m.rds')
USDCAD.Garch.d3m <- readRDS('./data/USDCAD.Garch.d3m.rds')
USDCHF.Garch.d3m <- readRDS('./data/USDCHF.Garch.d3m.rds')
USDCNY.Garch.d3m <- readRDS('./data/USDCNY.Garch.d3m.rds')
USDJPY.Garch.d3m <- readRDS('./data/USDJPY.Garch.d3m.rds')
```

```{r day6m-Garch, eval=FALSE}
## Using closing price to forecast.
#'@ source('./function/Garch.d6m.R')
AUDUSD.Garch.d6m <- readRDS('./data/AUDUSD.Garch.d6m.rds')
EURUSD.Garch.d6m <- readRDS('./data/EURUSD.Garch.d6m.rds')
GBPUSD.Garch.d6m <- readRDS('./data/GBPUSD.Garch.d6m.rds')
USDCAD.Garch.d6m <- readRDS('./data/USDCAD.Garch.d6m.rds')
USDCHF.Garch.d6m <- readRDS('./data/USDCHF.Garch.d6m.rds')
USDCNY.Garch.d6m <- readRDS('./data/USDCNY.Garch.d6m.rds')
USDJPY.Garch.d6m <- readRDS('./data/USDJPY.Garch.d6m.rds')
```

```{r day1y-Garch, eval=FALSE}
## Using closing price to forecast.
#'@ source('./function/Garch.d1y.R')
AUDUSD.Garch.d1y <- readRDS('./data/AUDUSD.Garch.d1y.rds')
EURUSD.Garch.d1y <- readRDS('./data/EURUSD.Garch.d1y.rds')
GBPUSD.Garch.d1y <- readRDS('./data/GBPUSD.Garch.d1y.rds')
USDCAD.Garch.d1y <- readRDS('./data/USDCAD.Garch.d1y.rds')
USDCHF.Garch.d1y <- readRDS('./data/USDCHF.Garch.d1y.rds')
USDCNY.Garch.d1y <- readRDS('./data/USDCNY.Garch.d1y.rds')
USDJPY.Garch.d1y <- readRDS('./data/USDJPY.Garch.d1y.rds')
```

## Multivariate Garch Models

Kindly refer to paper [binary.com Interview Question I - Multivariate GARCH Models](http://rpubs.com/englianhu/binary-Q1Multi-GARCH).

# Mean Squared Error (MSE)

## Auto Arima Models

  Now we look at the accuracy of prediction.

```{r res-AutoArima, warning=FALSE, echo=FALSE}
## 3 months data for daily price.
AutoArima.day.3m <- dir('./data/', pattern = '^[A-Z]{6}.AutoArima.d3m.rds$') %>% str_replace_all('.rds', '')
d3m <- ldply(AutoArima.day.3m, function(x) {
  z = readRDS(paste0('./data/', x, '.rds')) %>% na.omit
  #data.frame(x$Point.Forecast, Cl(x))
  mse = mean((z$Point.Forecast - Cl(z))^2)
  data.frame(Currency = str_replace_all(x, '.d3m', ''), MSE.3M = mse)
  })


## 6 months data for daily price.
AutoArima.day.6m <- dir('./data/', pattern = '^[A-Z]{6}.AutoArima.d6m.rds$') %>% str_replace_all('.rds', '')
d6m <- ldply(AutoArima.day.6m, function(x) {
  z = readRDS(paste0('./data/', x, '.rds')) %>% na.omit
  #data.frame(x$Point.Forecast, Cl(x))
  mse = mean((z$Point.Forecast - Cl(z))^2)
  data.frame(Currency = str_replace_all(x, '.d6m', ''), MSE.6M = mse)
  })


## 1 year data for daily price.
AutoArima.day.1y <- dir('./data/', pattern = '^[A-Z]{6}.AutoArima.d1y.rds$') %>% str_replace_all('.rds', '')
d1y <- ldply(AutoArima.day.1y, function(x) {
  z = readRDS(paste0('./data/', x, '.rds')) %>% na.omit
  #data.frame(x$Point.Forecast, Cl(x))
  mse = mean((z$Point.Forecast - Cl(z))^2)
  data.frame(Currency = str_replace_all(x, '.d1y', ''), MSE.1Y = mse)
  })

mse.arima <- suppressAll(join_all(list(d3m, d6m, d1y), type = 'full'))
mse.arima <- suppressAll(rbind(mse.arima, c('Mean = ', colMeans(mse.arima[-1]))))
mse.arima %<>% tbl_df %>% mutate(
  Currency = as.character(Currency), 
  MSE.3M = as.numeric(MSE.3M), 
  MSE.6M = as.numeric(MSE.6M), 
  MSE.1Y = as.numeric(MSE.1Y))
mse.arima$Currency[length(mse.arima$Currency)] <- 'Mean = '

mse.arima %>% 
  kable(caption = 'MSE Table') %>% 
  kable_styling(bootstrap_options = c('striped', 'hover', 'condensed', 'responsive')) %>%
  scroll_box(width = '100%', height = '400px')
#|Currency         |    MSE.3M|    MSE.6M|    MSE.1Y|
#|:----------------|---------:|---------:|---------:|
#|AUDUSD.AutoArima | 0.0000252| 0.0000245| 0.0000243|
#|EURUSD.AutoArima | 0.0000390| 0.0000393| 0.0000385|
#|GBPUSD.AutoArima | 0.0000722| 0.0000689| 0.0000676|
#|USDCAD.AutoArima | 0.0000434| 0.0000423| 0.0000416|
#|USDCHF.AutoArima | 0.0000589| 0.0000586| 0.0000564|
#|USDCNY.AutoArima | 0.0002294| 0.0002117| 0.0002072|
#|USDJPY.AutoArima | 0.4468217| 0.4273710| 0.4172619|
#|Mean =           | 0.0638985| 0.0611166| 0.0596711|
```

  Below is the summary of Yahoo data.

```{r res-yahooAutoArima, warning=FALSE, echo=FALSE}
## 3 months data for daily price.
yahooAutoArima.day.3m <- dir('./data/', pattern = '^[A-Z]{6}.yahooAutoArima.d3m.rds$') %>% str_replace_all('.rds', '')
d3m <- ldply(yahooAutoArima.day.3m, function(x) {
  z = readRDS(paste0('./data/', x, '.rds')) %>% na.omit
  #data.frame(x$Point.Forecast, Cl(x))
  mse = mean((z$Point.Forecast - Cl(z))^2)
  data.frame(Currency = str_replace_all(x, '.d3m', ''), MSE.3M = mse)
  })


## 6 months data for daily price.
yahooAutoArima.day.6m <- dir('./data/', pattern = '^[A-Z]{6}.yahooAutoArima.d6m.rds$') %>% str_replace_all('.rds', '')
d6m <- ldply(yahooAutoArima.day.6m, function(x) {
  z = readRDS(paste0('./data/', x, '.rds')) %>% na.omit
  #data.frame(x$Point.Forecast, Cl(x))
  mse = mean((z$Point.Forecast - Cl(z))^2)
  data.frame(Currency = str_replace_all(x, '.d6m', ''), MSE.6M = mse)
  })


## 1 year data for daily price.
yahooAutoArima.day.1y <- dir('./data/', pattern = '^[A-Z]{6}.yahooAutoArima.d1y.rds$') %>% str_replace_all('.rds', '')
d1y <- ldply(yahooAutoArima.day.1y, function(x) {
  z = readRDS(paste0('./data/', x, '.rds')) %>% na.omit
  #data.frame(x$Point.Forecast, Cl(x))
  mse = mean((z$Point.Forecast - Cl(z))^2)
  data.frame(Currency = str_replace_all(x, '.d1y', ''), MSE.1Y = mse)
  })


## 18 months data for daily price.
yahooAutoArima.day.18m <- dir('./data/', pattern = '^[A-Z]{6}.yahooAutoArima.d18m.rds$') %>% str_replace_all('.rds', '')
d18m <- ldply(yahooAutoArima.day.18m, function(x) {
  z = readRDS(paste0('./data/', x, '.rds')) %>% na.omit
  #data.frame(x$Point.Forecast, Cl(x))
  mse = mean((z$Point.Forecast - Cl(z))^2)
  data.frame(Currency = str_replace_all(x, '.d18m', ''), MSE.18M = mse)
  })


## 2 years data for daily price.
yahooAutoArima.day.2y <- dir('./data/', pattern = '^[A-Z]{6}.yahooAutoArima.d2y.rds$') %>% str_replace_all('.rds', '')
d2y <- ldply(yahooAutoArima.day.2y, function(x) {
  z = readRDS(paste0('./data/', x, '.rds')) %>% na.omit
  #data.frame(x$Point.Forecast, Cl(x))
  mse = mean((z$Point.Forecast - Cl(z))^2)
  data.frame(Currency = str_replace_all(x, '.d2y', ''), MSE.2Y = mse)
  })


## Summary
mse.arima <- suppressAll(join_all(list(d3m, d6m, d1y, d18m, d2y), type = 'full'))
mse.arima <- suppressAll(rbind(mse.arima, c('Mean = ', colMeans(mse.arima[-1]))))
mse.arima %<>% tbl_df %>% mutate(
  Currency = as.character(Currency), 
  MSE.3M = as.numeric(MSE.3M), 
  MSE.6M = as.numeric(MSE.6M), 
  MSE.1Y = as.numeric(MSE.1Y), 
  MSE.18M = as.numeric(MSE.18M), 
  MSE.2Y = as.numeric(MSE.2Y))
mse.arima$Currency[length(mse.arima$Currency)] <- 'Mean = '

mse.arima %>% 
  kable(caption = 'MSE Table') %>% 
  kable_styling(bootstrap_options = c('striped', 'hover', 'condensed', 'responsive')) %>%
  scroll_box(width = '100%', height = '400px')
#|Currency              |    MSE.3M|    MSE.6M|    MSE.1Y|   MSE.18M|    MSE.2Y|
#|:---------------------|---------:|---------:|---------:|---------:|---------:|
#|USDAUD.yahooAutoArima | 0.0000725| 0.0000691| 0.0000680| 0.0000683| 0.0000674|
#|USDCAD.yahooAutoArima | 0.0000426| 0.0000418| 0.0000411| 0.0000411| 0.0000412|
#|USDCHF.yahooAutoArima | 0.0000581| 0.0000562| 0.0000569| 0.0000564| 0.0000554|
#|USDCNY.yahooAutoArima | 0.0002035| 0.0001980| 0.0001953| 0.0001981| 0.0001988|
#|USDEUR.yahooAutoArima | 0.0000269| 0.0000263| 0.0000261| 0.0000268| 0.0000259|
#|USDGBP.yahooAutoArima | 0.0000219| 0.0000203| 0.0000190| 0.0000194| 0.0000193|
#|USDJPY.yahooAutoArima | 0.4893502| 0.4700268| 0.4593798| 0.4691871| 0.4666987|
#|Mean =                | 0.0699680| 0.0672055| 0.0656837| 0.0670853| 0.0667295|
```

## Exponential Smoothing Models

  Similar with univariate `auto.arima` model, here we try to compare the the accuracy of prediction of univariate `ets` models among the portfolios where each portfolio contains USD exchanged with other currencies.

```{r res-ETS, warning=FALSE, echo=FALSE}
## 3 months data for daily price.
ETS.day.3m <- dir('./data/', pattern = '^[A-Z]{6}.[A-Z]{3}.Cl.d3m.rds$') %>% str_replace_all('.rds', '')
d3m <- ldply(ETS.day.3m, function(x) {
  z = readRDS(paste0('./data/', x, '.rds')) %>% na.omit
  #data.frame(x$Point.Forecast, Cl(x))
  mse = mean((z$Point.Forecast - Cl(z))^2)
  data.frame(Currency = str_replace_all(x, '.Cl.d3m', ''), MSE.3M = mse)
  })


## 6 months data for daily price.
ETS.day.6m <- dir('./data/', pattern = '^[A-Z]{6}.[A-Z]{3}.Cl.d6m.rds$') %>% str_replace_all('.rds', '')
d6m <- ldply(ETS.day.6m, function(x) {
  z = readRDS(paste0('./data/', x, '.rds')) %>% na.omit
  #data.frame(x$Point.Forecast, Cl(x))
  mse = mean((z$Point.Forecast - Cl(z))^2)
  data.frame(Currency = str_replace_all(x, '.Cl.d6m', ''), MSE.6M = mse)
  })


## 1 year data for daily price.
ETS.day.1y <- dir('./data/', pattern = '^[A-Z]{6}.[A-Z]{3}.Cl.d1y.rds$') %>% str_replace_all('.rds', '')
d1y <- ldply(ETS.day.1y, function(x) {
  z = readRDS(paste0('./data/', x, '.rds')) %>% na.omit
  #data.frame(x$Point.Forecast, Cl(x))
  mse = mean((z$Point.Forecast - Cl(z))^2)
  data.frame(Currency = str_replace_all(x, '.Cl.d1y', ''), MSE.1Y = mse)
  })

mse.ETS <- suppressAll(join_all(list(d3m, d6m, d1y), type = 'full'))
mse.ETS %<>% tbl_df %>% mutate(
  Currency = as.character(Currency), 
  MSE.3M = as.numeric(MSE.3M), 
  MSE.6M = as.numeric(MSE.6M), 
  MSE.1Y = as.numeric(MSE.1Y))

mse.ETS %<>% separate(Currency, c('Currency', 'Model'))
mse.ETS %<>% ddply(.(Model), summarise, MSE.3M = mean(MSE.3M), 
                                        MSE.6M = mean(MSE.6M), 
										MSE.1Y = mean(MSE.1Y))
mse.ETS %>% 
  kable(caption = 'MSE Table') %>% 
  kable_styling(bootstrap_options = c('striped', 'hover', 'condensed', 'responsive')) %>%
  scroll_box(width = '100%', height = '400px')
#|Model |    MSE.3M|    MSE.6M|    MSE.1Y|
#|:-----|---------:|---------:|---------:|
#|AAN   | 0.0638216| 0.0602470| 0.0596556|
#|AAZ   | 0.0638216| 0.0602470| 0.0596556|
#|ANN   | 0.0580867| 0.0577726| 0.0577719|
#|ANZ   | 0.0580867| 0.0577726| 0.0577719|
#|AZN   | 0.0620494| 0.0589684| 0.0585482|
#|AZZ   | 0.0620494| 0.0589684| 0.0585482|
#|MAN   | 0.0641544| 0.0604866| 0.0598502|
#|MAZ   | 0.0641544| 0.0604866| 0.0598502|
#|MMN   | 0.0646267| 0.0602590| 0.0591698|
#|MMZ   | 0.0646267| 0.0602590| 0.0591698|
#|MNN   | 0.0580857| 0.0577605| 0.0577702|
#|MNZ   | 0.0580857| 0.0577605| 0.0577702|
#|MZN   | 0.0622906| 0.0589968| 0.0586481|
#|MZZ   | 0.0622906| 0.0589968| 0.0586481|
#|ZAN   | 0.0640052| 0.0603903| 0.0597147|
#|ZAZ   | 0.0640052| 0.0603903| 0.0597147|
#|ZMN   | 0.0646267| 0.0602590| 0.0591698|
#|ZMZ   | 0.0646267| 0.0602590| 0.0591698|
#|ZNN   | 0.0580782| 0.0577591| 0.0577670|
#|ZNZ   | 0.0580782| 0.0577591| 0.0577670|
#|ZZN   | 0.0622681| 0.0590432| 0.0586071|
#|ZZZ   | 0.0622681| 0.0590432| 0.0586071|
```

   Application of ETS models onto the Yahoo data as below.

```{r res-yahooETS, warning=FALSE, echo=FALSE}
## 3 months data for daily price.
yahooETS.day.3m <- dir('./data/', pattern = '^[A-Z]{6}.yahoo.[A-Z]{3}.Cl.d3m.rds$') %>% str_replace_all('.rds', '')
d3m <- ldply(yahooETS.day.3m, function(x) {
  z = readRDS(paste0('./data/', x, '.rds')) %>% na.omit
  #data.frame(x$Point.Forecast, Cl(x))
  mse = mean((z$Point.Forecast - Cl(z))^2)
  data.frame(Currency = str_replace_all(x, '.Cl.d3m', ''), MSE.3M = mse)
  })


## 6 months data for daily price.
yahooETS.day.6m <- dir('./data/', pattern = '^[A-Z]{6}.yahoo.[A-Z]{3}.Cl.d6m.rds$') %>% str_replace_all('.rds', '')
d6m <- ldply(yahooETS.day.6m, function(x) {
  z = readRDS(paste0('./data/', x, '.rds')) %>% na.omit
  #data.frame(x$Point.Forecast, Cl(x))
  mse = mean((z$Point.Forecast - Cl(z))^2)
  data.frame(Currency = str_replace_all(x, '.Cl.d6m', ''), MSE.6M = mse)
  })


## 1 year data for daily price.
yahooETS.day.1y <- dir('./data/', pattern = '^[A-Z]{6}.yahoo.[A-Z]{3}.Cl.d1y.rds$') %>% str_replace_all('.rds', '')
d1y <- ldply(yahooETS.day.1y, function(x) {
  z = readRDS(paste0('./data/', x, '.rds')) %>% na.omit
  #data.frame(x$Point.Forecast, Cl(x))
  mse = mean((z$Point.Forecast - Cl(z))^2)
  data.frame(Currency = str_replace_all(x, '.Cl.d1y', ''), MSE.1Y = mse)
  })


## 18 months data for daily price.
yahooETS.day.18m <- dir('./data/', pattern = '^[A-Z]{6}.yahoo.[A-Z]{3}.Cl.d18m.rds$') %>% str_replace_all('.rds', '')
d18m <- ldply(yahooETS.day.18m, function(x) {
  z = readRDS(paste0('./data/', x, '.rds')) %>% na.omit
  #data.frame(x$Point.Forecast, Cl(x))
  mse = mean((z$Point.Forecast - Cl(z))^2)
  data.frame(Currency = str_replace_all(x, '.Cl.d18m', ''), MSE.18M = mse)
  })


## 2 years data for daily price.
yahooETS.day.2y <- dir('./data/', pattern = '^[A-Z]{6}.yahoo.[A-Z]{3}.Cl.d2y.rds$') %>% str_replace_all('.rds', '')
d2y <- ldply(yahooETS.day.2y, function(x) {
  z = readRDS(paste0('./data/', x, '.rds')) %>% na.omit
  #data.frame(x$Point.Forecast, Cl(x))
  mse = mean((z$Point.Forecast - Cl(z))^2)
  data.frame(Currency = str_replace_all(x, '.Cl.d2y', ''), MSE.2Y = mse)
  })


# Summary
mse.ETS <- suppressAll(join_all(list(d3m, d6m, d1y, d18m, d2y), type = 'full'))
mse.ETS %<>% tbl_df %>% mutate(
  Currency = as.character(Currency), 
  MSE.3M = as.numeric(MSE.3M), 
  MSE.6M = as.numeric(MSE.6M), 
  MSE.1Y = as.numeric(MSE.1Y), 
  MSE.18M = as.numeric(MSE.18M), 
  MSE.2Y = as.numeric(MSE.2Y))

mse.ETS %<>% separate(Currency, c('Currency', 'Data', 'Model'))
mse.ETS %<>% ddply(.(Model), summarise, MSE.3M = mean(MSE.3M), 
                                        MSE.6M = mean(MSE.6M), 
										MSE.1Y = mean(MSE.1Y), 
										MSE.18M = mean(MSE.18M), 
										MSE.2Y = mean(MSE.2Y))
mse.ETS %>% 
  kable(caption = 'MSE Table') %>% 
  kable_styling(bootstrap_options = c('striped', 'hover', 'condensed', 'responsive')) %>%
  scroll_box(width = '100%', height = '400px')
#|Model |    MSE.3M|    MSE.6M|    MSE.1Y|  MSE.18M|   MSE.2Y|
#|:-----|---------:|---------:|---------:|--------:|--------:|
#|AAN   | 0.1277581| 0.2158374| 0.7374775| 2.167684| 5.761272|
#|ANN   | 0.1188879| 0.2085196| 0.7365478| 2.176026| 5.740889|
#|MAN   | 0.0000770| 0.0001709|        NA|       NA|       NA|
#|MNN   | 0.1187965| 0.2083754| 0.7365477| 2.176137| 5.740912|
#|ZNN   | 0.1188117| 0.2084939| 0.7365720| 2.175976| 5.740875|
```

## Univariate Garch Models and EWMA

  Few forecasted data price had bias standard error to cause the result not accutate.

```{r res-Garch, warning=FALSE, echo=FALSE}
## 3 months data for daily price.
Garch.day.3m <- dir('./data/', pattern = '^[A-Z]{6}.+GARCH+.Cl.snorm.hybrid.d3m.rds$') %>% str_replace_all('.rds', '')
d3m <- ldply(Garch.day.3m, function(x) {
  z = readRDS(paste0('./data/', x, '.rds')) %>% na.omit
  
  z$Point.Forecast = ifelse((z$Point.Forecast >= (Cl(z) * 1.5)|
                             z$Point.Forecast <= (Cl(z) * 1.5)), 
                             0, z$Point.Forecast)
  
  #data.frame(x$Point.Forecast, Cl(x))
  mse = mean((z$Point.Forecast - Cl(z))^2)
  data.frame(Currency = str_replace_all(x, '.Cl+.+.d3m', ''), MSE.3M = mse)
  })


## 6 months data for daily price.
Garch.day.6m <- dir('./data/', pattern = '^[A-Z]{6}.+GARCH+.Cl.snorm.hybrid.d6m.rds$') %>% str_replace_all('.rds', '')
d6m <- ldply(Garch.day.6m, function(x) {
  z = readRDS(paste0('./data/', x, '.rds')) %>% na.omit
  
  z$Point.Forecast = ifelse((z$Point.Forecast >= (Cl(z) * 1.5)|
                             z$Point.Forecast <= (Cl(z) * 1.5)), 
                             0, z$Point.Forecast)
  
  #data.frame(x$Point.Forecast, Cl(x))
  mse = mean((z$Point.Forecast - Cl(z))^2)
  data.frame(Currency = str_replace_all(x, '.Cl+.+.d6m', ''), MSE.6M = mse)
  })


## 1 year data for daily price.
Garch.day.1y <- dir('./data/', pattern = '^[A-Z]{6}.+GARCH+.Cl.snorm.hybrid.d1y.rds$') %>% str_replace_all('.rds', '')
d1y <- ldply(Garch.day.1y, function(x) {
  z = readRDS(paste0('./data/', x, '.rds')) %>% na.omit
  
  z$Point.Forecast = ifelse((z$Point.Forecast >= (Cl(z) * 1.5)|
                             z$Point.Forecast <= (Cl(z) * 1.5)), 
                             0, z$Point.Forecast)
  
  #data.frame(x$Point.Forecast, Cl(x))
  mse = mean((z$Point.Forecast - Cl(z))^2)
  data.frame(Currency = str_replace_all(x, '.Cl+.+.d1y', ''), MSE.1Y = mse)
  })

mse.Garch <- suppressAll(join_all(list(d3m, d6m, d1y), type = 'full'))
mse.Garch %<>% tbl_df %>% mutate(
  Currency = as.character(Currency), 
  MSE.3M = as.numeric(MSE.3M), 
  MSE.6M = as.numeric(MSE.6M), 
  MSE.1Y = as.numeric(MSE.1Y))

mse.Garch %<>% separate(Currency, c('Currency', 'Model', 'Submodel', 'Sub-submodel'))
mse.Garch %<>% ddply(.(Model), summarise, 
                     MSE.3M = mean(MSE.3M), 
                     MSE.6M = mean(MSE.6M), 
                     MSE.1Y = mean(MSE.1Y))
mse.Garch %>% 
  kable(caption = 'MSE Table') %>% 
  kable_styling(bootstrap_options = c('striped', 'hover', 'condensed', 'responsive')) %>%
  scroll_box(width = '100%', height = '400px')
```

## Multivariate Garch Models

Kindly refer to paper [binary.com Interview Question I - Multivariate GARCH Models](http://rpubs.com/englianhu/binary-Q1Multi-GARCH).

# Model Comparison

```{r variables}
## set all models provided by ets function.
ets.m <- c('AAN', 'AAZ', 'ANN', 'ANZ', 'AZN', 'AZZ', 'MAN', 'MAZ', 'MMN', 
            'MMZ', 'MNN', 'MNZ', 'MZN', 'MZZ', 'ZAN', 'ZAZ', 'ZMN', 'ZMZ', 
            'ZNN', 'ZNZ', 'ZZN', 'ZZZ')

## Multiple Garch models inside `rugarch` package.
garch.m <- c('sGARCH', 'fGARCH', 'eGARCH', 'gjrGARCH', 'apARCH', 'iGARCH', 'csGARCH', 'realGARCH')
garch.m <- garch.m[-length(garch.m)] #skip `realGARCH`

solver <- c('hybrid', 'solnp', 'nlminb', 'gosolnp', 'nloptr', 'lbfgs')

sub.garch.m <<- c('GARCH', 'TGARCH', 'AVGARCH', 'NGARCH', 'NAGARCH', 'APARCH', 'GJRGARCH', 'ALLGARCH')

dist.model <- c('norm', 'snorm', 'std', 'sstd', 'ged', 'sged', 'nig', 'ghyp', 'jsu')
```

```{r comp, eval=FALSE}
getSymbols('JPY=X', from = Sys.Date() %m-% years(1), to = Sys.Date())
USDJPY <- `JPY=X` %>% Cl %>% na.omit; rm(`JPY=X`)
names(USDJPY) %<>% str_replace_all('JPY=X', 'USDJPY')

## Auto Arima
pre1 <- auto.arima(USDJPY)
saveRDS(pre1, './data/pre1.rds')

## ETS
pre2 <- llply(ets.m, function(x) ets(USDJPY, model = x))
names(pre2) = ets.m
saveRDS(pre2, './data/pre2.rds')

## Garch
#'@ pre3 <- llply(garch.m, function(x){
#'@   gm = llply(dist.model, function(y){
#'@       if(x == 'fGARCH') {
#'@         sgm = llply(sub.garch.m, function(z) {
#'@           spec = ugarchspec(variance.model = list(
#'@             model = x, garchOrder = c(1, 1), 
#'@             submodel = z, external.regressors = NULL, 
#'@             variance.targeting = FALSE), distribution.model = y)
#'@           fit = ugarchfit(spec, USDJPY, solver = 'hybrid')
#'@             })
#'@         names(sgm) = sub.garch.m; sgm
#'@           } else {
#'@             spec = ugarchspec(variance.model = list(
#'@               model = x, garchOrder = c(1, 1), 
#'@               submodel = NULL, external.regressors = NULL, 
#'@               variance.targeting = FALSE), distribution.model = y)
#'@             fit = ugarchfit(spec, USDJPY, solver = 'hybrid')
#'@           }
#'@       })
#'@   names(gm) = dist.model; gm
#'@   })
#'@ names(pre3) = garch.m

## Garch models
pre3b <- llply(garch.m, function(x){
  armaOrder = armaSearch(USDJPY)
  armaOrder %<>% dplyr::filter(AIC==min(AIC)) %>% .[c('p', 'q')] %>% unlist
  spec = ugarchspec(
    variance.model = list(
      model = x, garchOrder = c(1, 1), 
      submodel = NULL, external.regressors = NULL, 
      variance.targeting = FALSE), 
    mean.model = list(
      armaOrder = armaOrder, 
      include.mean = TRUE, archm = FALSE, 
      archpow = 1, arfima = FALSE, 
      external.regressors = NULL, 
      archex = FALSE), 
    distribution.model = 'snorm')
        fit = ugarchfit(spec, USDJPY, solver = 'hybrid')
      }
  })
saveRDS(pre3b, './data/pre3b.rds')

## gjrGARCH model's distributions...
pre3c <- llply(dist.model, function(x){
  armaOrder = armaSearch(USDJPY)
  armaOrder %<>% dplyr::filter(AIC==min(AIC)) %>% .[c('p', 'q')] %>% unlist
  spec = ugarchspec(
    variance.model = list(
      model = 'gjrGARCH', garchOrder = c(3, 3), 
      submodel = NULL, external.regressors = NULL, 
      variance.targeting = FALSE), 
    mean.model = list(
      armaOrder = armaOrder, 
      include.mean = TRUE, archm = FALSE, 
      archpow = 1, arfima = FALSE, 
      external.regressors = NULL, 
      archex = FALSE), 
    distribution.model = x)
  fit = ugarchfit(spec, USDJPY, solver = 'hybrid')
  })
saveRDS(pre3c, './data/pre3c.rds')

## gjrGARCH model's distributions...
pre3d <- llply(solver, function(x){
  armaOrder = armaSearch(USDJPY)
  armaOrder %<>% dplyr::filter(AIC==min(AIC)) %>% .[c('p', 'q')] %>% unlist
  spec = ugarchspec(
    variance.model = list(
      model = 'gjrGARCH', garchOrder = c(3, 3), 
      submodel = NULL, external.regressors = NULL, 
      variance.targeting = FALSE), 
    mean.model = list(
      armaOrder = armaOrder, 
      include.mean = TRUE, archm = FALSE, 
      archpow = 1, arfima = FALSE, 
      external.regressors = NULL, 
      archex = FALSE), 
    distribution.model = 'snorm')
  fit = ugarchfit(spec, USDJPY, solver = x)
  })
saveRDS(pre3d, './data/pre3d.rds')
```

```{r read-pre}
pre1 <- readRDS('./data/pre1.rds')
pre2 <- readRDS('./data/pre2.rds')
pre3 <- readRDS('./data/pre3.rds') %>% unlist
pre3b <- readRDS('./data/pre3b.rds') %>% unlist
names(pre3b) = paste0(names(pre3b),'.optimalArmaPQ')
pre3c <- readRDS('./data/pre3c.rds') %>% unlist
names(pre3c) = paste0('gjrGARCH.', dist.model)
pre3d <- readRDS('./data/pre3d.rds') %>% unlist
names(pre3d) = paste0('gjrGARCH.', solver)
```

```{r AIC, warning=FALSE}
aic1 <- data.frame(.id = 'Auto.Arima', V1 = AIC(pre1))
aic2 <- ldply(pre2, AIC)
aic3 <- ldply(pre3, function(x) infocriteria(x)[1])
aic3b <- ldply(pre3b, function(x) infocriteria(x)[1])
aic3c <- ldply(pre3c, function(x) infocriteria(x)[1])
aic3d <- ldply(pre3d, function(x) tryCatch(infocriteria(x), error = function(e) NA)[1]) %>% na.omit

aic.s <- bind_rows(aic1, aic2, aic3, aic3b, aic3c, aic3d)
names(aic.s) <- c('.id', 'AIC')

aic.s %>% formattable(list(
    
    .id = color_tile('white', 'darkgoldenrod'), 
    
    AIC = formatter('span', style = x ~ formattable::style(
        color = ifelse(rank(x) >= 3, 'gray', 'green')), 
        x ~ sprintf("%.6f (rank: %01.0f)", x, rank(x)))))
```


# Conclusion

Due to the prediction result abnormal in [Univariate Garch Models and EWMA], here I unable to determine the best fit data size for GARCH model. Therefore I refer to auto.arima model and ETS models to choose `MSE.1Y` is the best fit data size.

in order to cope with the problem. I compare the `AIC` value. Due to ETS and Arima model do not measure the volatility, there is totally different models and the `AIC` value thousands times GARCH models. The paper concludes that *gjrGARCH* is the best model.

- gjrGARCH `2.037765 (rank: 19)` is the best GARCH model (without adjust arma order) among the rest.
- gjrGARCH with order order `1.931967 (rank: 01)` is the best fit model.
- gjrGARCH with `snorm` or `hybrid` or `solnp` distribution is the best among using other distributions.

```
gjrGARCH.optimalArmaPQ        1.931967 (rank: 01)
fGARCH.NGARCH.optimalArmaPQ   1.941874 (rank: 02)
gjrGARCH.snorm                2.00356 (rank: 13)
gjrGARCH.hybrid               2.00356 (rank: 13)
gjrGARCH.solnp                2.00356 (rank: 13)
gjrGARCH                      2.037765 (rank: 19)
fGARCH.NAGARCH                2.050824 (rank: 24)
```

[binary.com Interview Question I - Comparison of Univariate GARCH Models](http://rpubs.com/englianhu/binary-Q1Uni-GARCH) is the next paper to adjust the `d` value for arma order which determine the best lag.

```{r stopPar, echo=FALSE}
## Set options back to original options
options(op)
options(warn = 0)
stopCluster(cl)
```

# Appendix

## Documenting File Creation 

  It's useful to record some information about how your file was created.

  - File creation date: 2015-07-22
  - File latest updated date: `r Sys.Date()`
  - `r R.version.string`
  - R version (short form): `r getRversion()`
  - [<span style='color:blue'>**rmarkdown** package</span>](https://github.com/rstudio/rmarkdown) version: `r packageVersion('rmarkdown')`
  - [<span style='color:blue'>**tufte** package</span>](https://github.com/rstudio/tufte) version: `r packageVersion('tufte')`
  - File version: 1.0.1
  - Author Profile: [<span style='color:blue'>®γσ, Eng Lian Hu</span>](https://beta.rstudioconnect.com/englianhu/ryo-eng/)
  - GitHub: [<span style='color:blue'>Source Code</span>](https://github.com/englianhu/binary.com-interview-question)
  - Additional session information
  
```{r info, echo=FALSE, warning=FALSE, results = 'asis'}
suppressMessages(require('dplyr', quietly = TRUE))
suppressMessages(require('formattable', quietly = TRUE))

lubridate::now()
sys1 <- devtools::session_info()$platform %>% unlist %>% data.frame(Category = names(.), session_info = .)
rownames(sys1) <- NULL
sys1 %>% formattable %>% as.htmlwidget

data.frame(Sys.info()) %>% mutate(Category = rownames(.)) %>% .[2:1] %>% rename(Category = Category, Sys.info =  Sys.info..) %>% formattable %>% as.htmlwidget

rm(sys1)
```

## Reference

  01. [<span style='color:blue'>Binary.com Interview Q1</span>](https://englianhu.github.io/2017/09/binary-forex-trading-Q1.html)(<span style='color:blue'>[Alternate link</span>](http://rpubs.com/englianhu/binary-forex-trading-Q1)) <img src='www/hot.jpg' width='20'>

**Powered by - Copyright® Intellectual Property Rights of <img src='www/oda-army2.jpg' width='24'> [<span style='color:blue'>Scibrokes®</span>](http://www.scibrokes.com)個人の経営企業**
