---
title: "<img src='https://raw.githubusercontent.com/englianhu/binary.com-interview-question/757b27e1e93132368b0898152078be4961b05a28/www/binary-logo-resize.jpg' width='240'>"
subtitle: "[<span style='color:blue'>binary.com</span>](https://github.com/englianhu/binary.com-interview-question) Interview Question I (Extention)"
author: "[<span style='color:blue'>®γσ, Lian Hu</span>](https://englianhu.github.io/) <img src='https://raw.githubusercontent.com/englianhu/binary.com-interview-question/master/www/ENG.jpg' width='24'> <img src='https://raw.githubusercontent.com/englianhu/binary.com-interview-question/master/www/RYO.jpg?raw=true' width='24'>白戸則道®"
date: "`r Sys.Date()`"
output:
  tufte::tufte_html:
    toc: yes
    toc_depth: 4
    self_contained: no
  tufte::tufte_book:
    citation_package: natbib
    latex_engine: xelatex
  tufte::tufte_handout:
    citation_package: natbib
    latex_engine: xelatex
link-citations: yes
---

```{r setup, include = FALSE}
#'@ rm(list = ls(all = TRUE))

suppressPackageStartupMessages(library('BBmisc'))
pkgs <- c('knitr', 'kableExtra', 'tint', 'devtools', 'lubridate', 'data.table', 'plyr', 'stringr', 'magrittr', 'dplyr', 'tidyr', 'tidyverse', 'ff', 'ffbase', 'tidyquant', 'sparklyr', 'readr', 'quantmod', 'htmltools', 'highcharter', 'googleVis', 'formattable', 'ggfortify', 'DT', 'forecast', 'Mcomp', 'MCMCpack', 'PerformanceAnalytics', 'broom', 'microbenchmark', 'doParallel', 'Boruta', 'fBasics', 'fPortfolio', 'rugarch', 'parma', 'rmgarch')
 
suppressAll(lib(pkgs))
#'@ install.packages(pkgs, lib = 'C:/Program Files/R/R-3.4.0/library')

suppressAll(l_ply(c('last.R', 'Mn.R', 'has.Mn.R', 'simAutoArima2.R', 'simETS2.R', 'plotChart2.R', 'armaSearch.R', 'simGarch2.R', 'quantitative-finance.R'), function(pkg) source(paste0('./function/', pkg))))
load('./Q1E.RData')

## Set option to below if you want to plot an independent webpage with graph 
#'@ op <- options(gvis.plot.tag=NULL)
op <- options(gvis.plot.tag = 'chart')
options(gvis.plot.tag = 'chart', warn = -1)
#'@ options(rpubs.upload.method = 'internal')

## R: llply fully reproducible results in parallel
## https://stackoverflow.com/questions/34946177/r-llply-fully-reproducible-results-in-parallel
cl <- makeCluster(detectCores())
registerDoParallel(cl)

## Create a cluster object to be used for rugarcgh and rmgarch models.
cluster = makePSOCKcluster(15)

## Connect to Spark.
#'@ spark_install()
#'@ sc <- spark_connect(master = 'local')

rm(pkgs)
```

# 1. Introduction

  By refer to *Ryo Eng Lian Hu (2017)*^[reference paper 1], I tried to compare few models for financial trading. Today I am using <s>1 minute, 3 minutes, 5 minutes, 10 minutes, 15 minutes, 30 minutes, 1 hour and also daily data instead of</s>^[Since the datasets contain few observation within a minute and also some data time period empty more than 30 minutes. Test all time period but eventually error...] only daily data. By the way, I try to compare the accuracy of forecasting instead of invesmnent.
  
  Besides, this paper will modelling multivariate Garch compare to previous paper which applied univariate Garch models.

# 2. Data

  I get the data from [**the Bonnot Gang** *1 Minute Historical Data Download*](http://thebonnotgang.com/tbg/historical-data/)^[Note: The CSV file is using ; (semicolon) as a separator and , (comma) as a decimal separator.].

```{r read-data, eval = FALSE, include = FALSE}
curr <- c('USDJPY', 'USDEUR', 'USDGBP', 'USDAUD', 'USDCAD', 'USDCHF')
prd <- paste0(1:1500, 'd')

curr.minute <- llply(curr[], function(cr) {
  llply(prd, function(dy) {
    f.get.google.intraday(cr, 60, dy)
  }) %>% do.call(rbind, .)
  curr.minute$High <- curr.minute$Open
  curr.minute$Low <- curr.minute$Open
  curr.minute$Close <- curr.minute$Open
})
names(curr.minute) <- curr

saveRDS(curr.minute, './data/USDJPY.Minute.rds')
USDJPY.Minute3 <- to.minutes3(USDJPY.Minute)
```

```{python, eval = FALSE, include = FALSE}
#!/usr/bin/env python 
"""
Retrieve intraday stock data from Google Finance.
"""
# https://gist.github.com/lebedov/f09030b865c4cb142af1

import './function/get_google_finance_intraday.py'
```

```{r read-data2, warning = FALSE, eval = FALSE, include = FALSE}
## Download the datasets from http://thebonnotgang.com/tbg/historical-data/ (2013-01-01 to 2017-08-31)
fls <- dir('./data', pattern = 'USD+.+.csv') %>% str_replace_all('_1m.csv', '')
mbase <- llply(fls, function(dt) {
  #'@ z = spark_read_csv(sc, path = paste0('./data/', dt), sep = ';') %>% dplyr::tbl_df %>% 
  z = data.table::fread(paste0('./data/', dt, '_1m.csv')) %>% dplyr::tbl_df %>% dplyr::select(symbol, timestamp, close) %>% 
    mutate(Symbol = factor(symbol), 
      #'@ Date = lubridate::ymd_hms(timestamp), 
      #'@ Date = as.POSIXct(strptime(timestamp, "%Y-%m-%d %H:%M:%S")), #filter as minute as the smallest unit
      Date = as.POSIXct(strptime(timestamp, "%Y-%m-%d %H:%M")), 
      Close = as.numeric(stringr::str_replace_all(close, ',', '.')))
  z$symbol = NULL
  z$timestamp = NULL
  z$close = NULL
  names(z) = c('Symbol' , 'Date', paste0(dt, c('.Close'))) #only get closing price
  z$Symbol = NULL
  #'@ z$Date = z$Date %>% stringr::str_replace_all(':[0-9]{2}$', '') %>% 
  #'@   lubridate::ymd_hm
  z %<>% unique
  z = xts(z[, -1], order.by = z$Date) %>% to.minutes
  #'@ indexTZ(z) <- 'America/Chicago'
  
  ## Create a column which contain the "first date 00:00:00" until the "last date time".
  tmp = xts(, seq.POSIXt(
    from = as.POSIXct(strptime(index(mbase[[1]])[1], "%Y-%m-%d")), 
    to = as.POSIXct(strptime(last(index(mbase[[1]])), "%Y-%m-%d %H:%M")), by = 'mins'))
  res = cbind(tmp, z) #cbind() will be faster than merge()
  na.locf(res)
 })#, .parallel = TRUE)

names(mbase) <- fls %>% str_replace_all('_1m.csv', '')
```

```{r dateID, warning = FALSE}
## dateID
#'@ dateID <- llply(mbase, function(x) index(x) %>% as.character) %>% 
#'@   unlist %>% unique %>% stringr::str_replace_all(':[0-9]{2}$', '') %>% 
#'@   lubridate::ymd_hm %>% sort

#'@ dateID <- llply(mbase, function(x) index(x) %>% as.character) %>% 
#'@   unlist %>% unique %>% lubridate::ymd_hms %>% sort
dateID <- llply(mbase, function(x) index(x) %>% as.character) %>% unlist %>% unique
dateID <- as.POSIXct(strptime(dateID, "%Y-%m-%d %H:%M")) %>% sort
dateID0 <- ymd('2014-01-01')
dateID <- dateID[dateID > dateID0]
```

```{r data-summ, warning = FALSE, echo = FALSE}
##  1 minute
mbase_min1 <- mbase
#'@ mbase_min1 <- llply(mbase, function(x) {
#'@   z = to.minutes(x)
#'@   nn = names(x) %>% str_replace_all('.Close', '')
#'@   names(z) = names(z) %>% str_replace_all('x', nn)
#'@   z})

##  3 minutes
mbase_min3 <- llply(mbase, function(x) {
  z = to.minutes3(x)
  nn = names(x) %>% str_replace_all('.Close', '')
  names(z) = names(z) %>% str_replace_all('x', nn)
  z})

##  5 minutes
mbase_min5 <- llply(mbase, function(x) {
  z = to.minutes5(x)
  nn = names(x) %>% str_replace_all('.Close', '')
  names(z) = names(z) %>% str_replace_all('x', nn)
  z})

##  10 minutes
mbase_min10 <- llply(mbase, function(x) {
  z = to.minutes10(x)
  nn = names(x) %>% str_replace_all('.Close', '')
  names(z) = names(z) %>% str_replace_all('x', nn)
  z})

##  15 minutes
mbase_min15 <- llply(mbase, function(x) {
  z = to.minutes15(x)
  nn = names(x) %>% str_replace_all('.Close', '')
  names(z) = names(z) %>% str_replace_all('x', nn)
  z})

##  30 minutes
mbase_min30 <- llply(mbase, function(x) {
  z = to.minutes30(x)
  nn = names(x) %>% str_replace_all('.Close', '')
  names(z) = names(z) %>% str_replace_all('x', nn)
  z})

##  1 hour
mbase_hrs1 <- llply(mbase, function(x) {
  z = to.hourly(x)
  nn = names(x) %>% str_replace_all('.Close', '')
  names(z) = names(z) %>% str_replace_all('x', nn)
  z})

##  1 day
mbase_day1 <- llply(mbase, function(x) {
  #'@ z %<>% mutate(Date = as.POSIXct(strptime(Date, "%Y-%m-%d %H")))
  z = to.daily(x)
  nn = names(x) %>% str_replace_all('.Close', '')
  names(z) = names(z) %>% str_replace_all('x', nn)
  z})

#'@ fx <- ldply(mbase, dim)
#'@ names(fx) <- c('Currency', 'Rows.all', 'Cols.all')
#'@ fx_1m <- ldply(mbase_min1, dim)
#'@ names(fx_1m) <- c('Currency', 'Rows.1m', 'Cols.1m')
fx_1m <- ldply(mbase, dim)
names(fx_1m) <- c('Currency', 'Rows.1m', 'Cols.1m')
fx_3m <- ldply(mbase_min3, dim)
names(fx_3m) <- c('Currency', 'Rows.3m', 'Cols.3m')
fx_5m <- ldply(mbase_min5, dim)
names(fx_5m) <- c('Currency', 'Rows.5m', 'Cols.5m')
fx_10m <- ldply(mbase_min10, dim)
names(fx_10m) <- c('Currency', 'Rows.10m', 'Cols.10m')
fx_15m <- ldply(mbase_min15, dim)
names(fx_15m) <- c('Currency', 'Rows.15m', 'Cols.15m')
fx_30m <- ldply(mbase_min30, dim)
names(fx_30m) <- c('Currency', 'Rows.30m', 'Cols.30m')
fx_1h <- ldply(mbase_hrs1, dim)
names(fx_1h) <- c('Currency', 'Rows.1h', 'Cols.1h')
fx_1d <- ldply(mbase_day1, dim)
names(fx_1d) <- c('Currency', 'Rows.1d', 'Cols.1d')

do.call(cbind, list(fx_1m, fx_3m, fx_5m, fx_10m, fx_15m, fx_30m, fx_1h, fx_1d)) %>% kable(width = 'auto')
```

# 3. Statiscal Modelling

## 3.1 Auto Arima Models

```{r minute1-AutoArima, warning = FALSE}
## Using closing price to forecast.
#'@ source('./function/AutoArima.min1.R')
AUDUSD.AutoArima.min1 <- readRDS('./data/AUDUSD.AutoArima.min1.rds')
EURUSD.AutoArima.min1 <- readRDS('./data/EURUSD.AutoArima.min1.rds')
GBPUSD.AutoArima.min1 <- readRDS('./data/GBPUSD.AutoArima.min1.rds')
USDCAD.AutoArima.min1 <- readRDS('./data/USDCAD.AutoArima.min1.rds')
USDCHF.AutoArima.min1 <- readRDS('./data/USDCHF.AutoArima.min1.rds')
USDCNY.AutoArima.min1 <- readRDS('./data/USDCNY.AutoArima.min1.rds')
USDJPY.AutoArima.min1 <- readRDS('./data/USDJPY.AutoArima.min1.rds')
```

```{r minute3-AutoArima, warning = FALSE}
## Using closing price to forecast.
#'@ source('./function/AutoArima.min3.R')
AUDUSD.AutoArima.min3 <- readRDS('./data/AUDUSD.AutoArima.min3.rds')
EURUSD.AutoArima.min3 <- readRDS('./data/EURUSD.AutoArima.min3.rds')
GBPUSD.AutoArima.min3 <- readRDS('./data/GBPUSD.AutoArima.min3.rds')
USDCAD.AutoArima.min3 <- readRDS('./data/USDCAD.AutoArima.min3.rds')
USDCHF.AutoArima.min3 <- readRDS('./data/USDCHF.AutoArima.min3.rds')
USDCNY.AutoArima.min3 <- readRDS('./data/USDCNY.AutoArima.min3.rds')
USDJPY.AutoArima.min3 <- readRDS('./data/USDJPY.AutoArima.min3.rds')
```

```{r minute5-AutoArima, warning = FALSE}
## Using closing price to forecast.
#'@ source('./function/AutoArima.min5.R')
AUDUSD.AutoArima.min5 <- readRDS('./data/AUDUSD.AutoArima.min5.rds')
EURUSD.AutoArima.min5 <- readRDS('./data/EURUSD.AutoArima.min5.rds')
GBPUSD.AutoArima.min5 <- readRDS('./data/GBPUSD.AutoArima.min5.rds')
USDCAD.AutoArima.min5 <- readRDS('./data/USDCAD.AutoArima.min5.rds')
USDCHF.AutoArima.min5 <- readRDS('./data/USDCHF.AutoArima.min5.rds')
USDCNY.AutoArima.min5 <- readRDS('./data/USDCNY.AutoArima.min5.rds')
USDJPY.AutoArima.min5 <- readRDS('./data/USDJPY.AutoArima.min5.rds')
```

```{r minute10-AutoArima, warning = FALSE}
## Using closing price to forecast.
#'@ source('./function/AutoArima.min10.R')
AUDUSD.AutoArima.min10 <- readRDS('./data/AUDUSD.AutoArima.min10.rds')
EURUSD.AutoArima.min10 <- readRDS('./data/EURUSD.AutoArima.min10.rds')
GBPUSD.AutoArima.min10 <- readRDS('./data/GBPUSD.AutoArima.min10.rds')
USDCAD.AutoArima.min10 <- readRDS('./data/USDCAD.AutoArima.min10.rds')
USDCHF.AutoArima.min10 <- readRDS('./data/USDCHF.AutoArima.min10.rds')
USDCNY.AutoArima.min10 <- readRDS('./data/USDCNY.AutoArima.min10.rds')
USDJPY.AutoArima.min10 <- readRDS('./data/USDJPY.AutoArima.min10.rds')
```

```{r minute15-AutoArima, warning = FALSE}
## Using closing price to forecast.
#'@ source('./function/AutoArima.min15.R')
AUDUSD.AutoArima.min15 <- readRDS('./data/AUDUSD.AutoArima.min15.rds')
EURUSD.AutoArima.min15 <- readRDS('./data/EURUSD.AutoArima.min15.rds')
GBPUSD.AutoArima.min15 <- readRDS('./data/GBPUSD.AutoArima.min15.rds')
USDCAD.AutoArima.min15 <- readRDS('./data/USDCAD.AutoArima.min15.rds')
USDCHF.AutoArima.min15 <- readRDS('./data/USDCHF.AutoArima.min15.rds')
USDCNY.AutoArima.min15 <- readRDS('./data/USDCNY.AutoArima.min15.rds')
USDJPY.AutoArima.min15 <- readRDS('./data/USDJPY.AutoArima.min15.rds')
```

```{r minute30-AutoArima, warning = FALSE}
## Using closing price to forecast.
#'@ source('./function/AutoArima.min30.R')
AUDUSD.AutoArima.min30 <- readRDS('./data/AUDUSD.AutoArima.min30.rds')
EURUSD.AutoArima.min30 <- readRDS('./data/EURUSD.AutoArima.min30.rds')
GBPUSD.AutoArima.min30 <- readRDS('./data/GBPUSD.AutoArima.min30.rds')
USDCAD.AutoArima.min30 <- readRDS('./data/USDCAD.AutoArima.min30.rds')
USDCHF.AutoArima.min30 <- readRDS('./data/USDCHF.AutoArima.min30.rds')
USDCNY.AutoArima.min30 <- readRDS('./data/USDCNY.AutoArima.min30.rds')
USDJPY.AutoArima.min30 <- readRDS('./data/USDJPY.AutoArima.min30.rds')
```

```{r hour1-AutoArima, warning = FALSE}
## Using closing price to forecast.
#'@ source('./function/AutoArima.h1.R')
AUDUSD.AutoArima.h1 <- readRDS('./data/AUDUSD.AutoArima.h1.rds')
EURUSD.AutoArima.h1 <- readRDS('./data/EURUSD.AutoArima.h1.rds')
GBPUSD.AutoArima.h1 <- readRDS('./data/GBPUSD.AutoArima.h1.rds')
USDCAD.AutoArima.h1 <- readRDS('./data/USDCAD.AutoArima.h1.rds')
USDCHF.AutoArima.h1 <- readRDS('./data/USDCHF.AutoArima.h1.rds')
USDCNY.AutoArima.h1 <- readRDS('./data/USDCNY.AutoArima.h1.rds')
USDJPY.AutoArima.h1 <- readRDS('./data/USDJPY.AutoArima.h1.rds')
```

```{r day6m-AutoArima, warning = FALSE}
## Using closing price to forecast.
#'@ source('./function/AutoArima.d6m.R')
AUDUSD.AutoArima.d6m <- readRDS('./data/AUDUSD.AutoArima.d6m.rds')
EURUSD.AutoArima.d6m <- readRDS('./data/EURUSD.AutoArima.d6m.rds')
GBPUSD.AutoArima.d6m <- readRDS('./data/GBPUSD.AutoArima.d6m.rds')
USDCAD.AutoArima.d6m <- readRDS('./data/USDCAD.AutoArima.d6m.rds')
USDCHF.AutoArima.d6m <- readRDS('./data/USDCHF.AutoArima.d6m.rds')
USDCNY.AutoArima.d6m <- readRDS('./data/USDCNY.AutoArima.d6m.rds')
USDJPY.AutoArima.d6m <- readRDS('./data/USDJPY.AutoArima.d6m.rds')
```

```{r day1y-AutoArima, warning = FALSE}
## Using closing price to forecast.
#'@ source('./function/AutoArima.d1y.R')
AUDUSD.AutoArima.d1y <- readRDS('./data/AUDUSD.AutoArima.d1y.rds')
EURUSD.AutoArima.d1y <- readRDS('./data/EURUSD.AutoArima.d1y.rds')
GBPUSD.AutoArima.d1y <- readRDS('./data/GBPUSD.AutoArima.d1y.rds')
USDCAD.AutoArima.d1y <- readRDS('./data/USDCAD.AutoArima.d1y.rds')
USDCHF.AutoArima.d1y <- readRDS('./data/USDCHF.AutoArima.d1y.rds')
USDCNY.AutoArima.d1y <- readRDS('./data/USDCNY.AutoArima.d1y.rds')
USDJPY.AutoArima.d1y <- readRDS('./data/USDJPY.AutoArima.d1y.rds')
```

## 3.2 Exponential Smoothing Models

```{r multi-etsM}
## set all models provided by ets function.
ets.m1 <- c('A', 'M', 'Z')
ets.m2 <- c('N', 'A', 'M', 'Z')
ets.m3 <- c('N', 'A', 'M', 'Z')
ets.m <- do.call(paste0, expand.grid(ets.m1, ets.m2, ets.m3))
rm(ets.m1, ets.m2, ets.m3)

pp <- expand.grid(c('Op', 'Hi', 'Mn', 'Lo', 'Cl'), c('Op', 'Hi', 'Mn', 'Lo', 'Cl')) %>% mutate(PP = paste(Var1, Var2)) %>% .$PP %>% str_split(' ')
```

```{r multi-ets, echo = FALSE, eval = FALSE}
## Application of Monte Carlo method to simulate 10000 times.
.baseDate = '2014-01-01 00:00:00'

res <- llply(ets.m, function(x) {
    llply(mbase_min1, function(y) {
        z = simETS2(y, .model = x, .prCat = 'Cl', .baseDate = .baseDate, 
                    .maPeriod = 'months', .unit = 6, .difftime = 'days')
        txt1 <- paste0('saveRDS(z', ', file = \'./data/', x, '.Cl.d6m.rds\'); rm(z)')
        eval(parse(text = txt1))
        cat(paste0(txt1, ' done!', '\n'))
    })
    cat(paste(x, 'done', '\n'))
    })
```

```{r minute1-ETS, warning = FALSE}
## Using closing price to forecast.
#'@ source('./function/ETS.min1.R')
AUDUSD.ETS.min1 <- readRDS('./data/AUDUSD.ETS.min1.rds')
EURUSD.ETS.min1 <- readRDS('./data/EURUSD.ETS.min1.rds')
GBPUSD.ETS.min1 <- readRDS('./data/GBPUSD.ETS.min1.rds')
USDCAD.ETS.min1 <- readRDS('./data/USDCAD.ETS.min1.rds')
USDCHF.ETS.min1 <- readRDS('./data/USDCHF.ETS.min1.rds')
USDCNY.ETS.min1 <- readRDS('./data/USDCNY.ETS.min1.rds')
USDJPY.ETS.min1 <- readRDS('./data/USDJPY.ETS.min1.rds')
```

```{r minute3-ETS, warning = FALSE}
## Using closing price to forecast.
#'@ source('./function/ETS.min3.R')
AUDUSD.ETS.min3 <- readRDS('./data/AUDUSD.ETS.min3.rds')
EURUSD.ETS.min3 <- readRDS('./data/EURUSD.ETS.min3.rds')
GBPUSD.ETS.min3 <- readRDS('./data/GBPUSD.ETS.min3.rds')
USDCAD.ETS.min3 <- readRDS('./data/USDCAD.ETS.min3.rds')
USDCHF.ETS.min3 <- readRDS('./data/USDCHF.ETS.min3.rds')
USDCNY.ETS.min3 <- readRDS('./data/USDCNY.ETS.min3.rds')
USDJPY.ETS.min3 <- readRDS('./data/USDJPY.ETS.min3.rds')
```

```{r minute5-ETS, warning = FALSE}
## Using closing price to forecast.
#'@ source('./function/ETS.min5.R')
AUDUSD.ETS.min5 <- readRDS('./data/AUDUSD.ETS.min5.rds')
EURUSD.ETS.min5 <- readRDS('./data/EURUSD.ETS.min5.rds')
GBPUSD.ETS.min5 <- readRDS('./data/GBPUSD.ETS.min5.rds')
USDCAD.ETS.min5 <- readRDS('./data/USDCAD.ETS.min5.rds')
USDCHF.ETS.min5 <- readRDS('./data/USDCHF.ETS.min5.rds')
USDCNY.ETS.min5 <- readRDS('./data/USDCNY.ETS.min5.rds')
USDJPY.ETS.min5 <- readRDS('./data/USDJPY.ETS.min5.rds')
```

```{r minute10-ETS, warning = FALSE}
## Using closing price to forecast.
#'@ source('./function/ETS.min10.R')
AUDUSD.ETS.min10 <- readRDS('./data/AUDUSD.ETS.min10.rds')
EURUSD.ETS.min10 <- readRDS('./data/EURUSD.ETS.min10.rds')
GBPUSD.ETS.min10 <- readRDS('./data/GBPUSD.ETS.min10.rds')
USDCAD.ETS.min10 <- readRDS('./data/USDCAD.ETS.min10.rds')
USDCHF.ETS.min10 <- readRDS('./data/USDCHF.ETS.min10.rds')
USDCNY.ETS.min10 <- readRDS('./data/USDCNY.ETS.min10.rds')
USDJPY.ETS.min10 <- readRDS('./data/USDJPY.ETS.min10.rds')
```

```{r minute15-ETS, warning = FALSE}
## Using closing price to forecast.
#'@ source('./function/ETS.min15.R')
AUDUSD.ETS.min15 <- readRDS('./data/AUDUSD.ETS.min15.rds')
EURUSD.ETS.min15 <- readRDS('./data/EURUSD.ETS.min15.rds')
GBPUSD.ETS.min15 <- readRDS('./data/GBPUSD.ETS.min15.rds')
USDCAD.ETS.min15 <- readRDS('./data/USDCAD.ETS.min15.rds')
USDCHF.ETS.min15 <- readRDS('./data/USDCHF.ETS.min15.rds')
USDCNY.ETS.min15 <- readRDS('./data/USDCNY.ETS.min15.rds')
USDJPY.ETS.min15 <- readRDS('./data/USDJPY.ETS.min15.rds')
```

```{r minute30-ETS, warning = FALSE}
## Using closing price to forecast.
#'@ source('./function/ETS.min30.R')
AUDUSD.ETS.min30 <- readRDS('./data/AUDUSD.ETS.min30.rds')
EURUSD.ETS.min30 <- readRDS('./data/EURUSD.ETS.min30.rds')
GBPUSD.ETS.min30 <- readRDS('./data/GBPUSD.ETS.min30.rds')
USDCAD.ETS.min30 <- readRDS('./data/USDCAD.ETS.min30.rds')
USDCHF.ETS.min30 <- readRDS('./data/USDCHF.ETS.min30.rds')
USDCNY.ETS.min30 <- readRDS('./data/USDCNY.ETS.min30.rds')
USDJPY.ETS.min30 <- readRDS('./data/USDJPY.ETS.min30.rds')
```

```{r hour1-ETS, warning = FALSE}
## Using closing price to forecast.
#'@ source('./function/ETS.h1.R')
AUDUSD.ETS.h1 <- readRDS('./data/AUDUSD.ETS.h1.rds')
EURUSD.ETS.h1 <- readRDS('./data/EURUSD.ETS.h1.rds')
GBPUSD.ETS.h1 <- readRDS('./data/GBPUSD.ETS.h1.rds')
USDCAD.ETS.h1 <- readRDS('./data/USDCAD.ETS.h1.rds')
USDCHF.ETS.h1 <- readRDS('./data/USDCHF.ETS.h1.rds')
USDCNY.ETS.h1 <- readRDS('./data/USDCNY.ETS.h1.rds')
USDJPY.ETS.h1 <- readRDS('./data/USDJPY.ETS.h1.rds')
```

```{r day6m-ETS, warning = FALSE}
## Using closing price to forecast.
#'@ source('./function/ETS.d6m.R')
AUDUSD.ETS.d6m <- readRDS('./data/AUDUSD.ETS.d6m.rds')
EURUSD.ETS.d6m <- readRDS('./data/EURUSD.ETS.d6m.rds')
GBPUSD.ETS.d6m <- readRDS('./data/GBPUSD.ETS.d6m.rds')
USDCAD.ETS.d6m <- readRDS('./data/USDCAD.ETS.d6m.rds')
USDCHF.ETS.d6m <- readRDS('./data/USDCHF.ETS.d6m.rds')
USDCNY.ETS.d6m <- readRDS('./data/USDCNY.ETS.d6m.rds')
USDJPY.ETS.d6m <- readRDS('./data/USDJPY.ETS.d6m.rds')
```

```{r day1y-ETS, warning = FALSE}
## Using closing price to forecast.
#'@ source('./function/ETS.d1y.R')
AUDUSD.ETS.d1y <- readRDS('./data/AUDUSD.ETS.d1y.rds')
EURUSD.ETS.d1y <- readRDS('./data/EURUSD.ETS.d1y.rds')
GBPUSD.ETS.d1y <- readRDS('./data/GBPUSD.ETS.d1y.rds')
USDCAD.ETS.d1y <- readRDS('./data/USDCAD.ETS.d1y.rds')
USDCHF.ETS.d1y <- readRDS('./data/USDCHF.ETS.d1y.rds')
USDCNY.ETS.d1y <- readRDS('./data/USDCNY.ETS.d1y.rds')
USDJPY.ETS.d1y <- readRDS('./data/USDJPY.ETS.d1y.rds')
```


## 3.3 Univariate Garch Models


## 3.4 Multivariate Garch Models

# 4. Mean Squared Error (MSE)

## 4.1 Auto Arima Models

```{r res-AutoArima, warning = FALSE}
## 6 months data for daily price.
AutoArima.day.6m <- dir('./data/', pattern = 'd6m.rds$') %>% str_replace_all('.rds', '')
d6m <- ldply(AutoArima.day.6m, function(x) {
  z = readRDS(paste0('./data/', x, '.rds'))
  #data.frame(x$Point.Forecast, Cl(x))
  mse = mean((z$Point.Forecast - Cl(z))^2)
  data.frame(Currency = str_replace_all(x, '.d6m', ''), MSE.6M = mse)
  })

## 1 year data for daily price.
AutoArima.day.1y <- dir('./data/', pattern = 'd1y.rds$') %>% str_replace_all('.rds', '')
d1y <- ldply(AutoArima.day.1y, function(x) {
  z = readRDS(paste0('./data/', x, '.rds'))
  #data.frame(x$Point.Forecast, Cl(x))
  mse = mean((z$Point.Forecast - Cl(z))^2)
  data.frame(Currency = str_replace_all(x, '.d1y', ''), MSE.1Y = mse)
  })

join(d6m, d1y) %>% kable(width = 'auto')

```

## 4.2 Exponential Smoothing Models

## 4.3 Univariate Garch Models

## 4.4 Multivariate Garch Models


# 5. 

## 5.1 Auto Arima Models

## 5.2 Exponential Smoothing Models

## 5.3 Univariate Garch Models

## 5.4 Multivariate Garch Models

# 6. Conclusion


```{r stopPar, echo = FALSE}
## Set options back to original options
options(op)
options(warn = 0)
stopCluster(cl)
```

# 7. Appendix

## 7.1 Documenting File Creation 

  It's useful to record some information about how your file was created.

  - File creation date: 2015-07-22
  - File latest updated date: `r Sys.Date()`
  - `r R.version.string`
  - R version (short form): `r getRversion()`
  - [<span style='color:blue'>**rmarkdown** package</span>](https://github.com/rstudio/rmarkdown) version: `r packageVersion('rmarkdown')`
  - [<span style='color:blue'>**tufte** package</span>](https://github.com/rstudio/tufte) version: `r packageVersion('tufte')`
  - File version: 1.0.1
  - Author Profile: [<span style='color:blue'>®γσ, Eng Lian Hu</span>](https://beta.rstudioconnect.com/englianhu/ryo-eng/)
  - GitHub: [<span style='color:blue'>Source Code</span>](https://github.com/scibrokes/betting-strategy-and-model-validation)
  - Additional session information
  
```{r info, echo = FALSE, warning = FALSE, results = 'asis'}
suppressMessages(require('dplyr', quietly = TRUE))
suppressMessages(require('formattable', quietly = TRUE))

lubridate::now()
sys1 <- devtools::session_info()$platform %>% unlist %>% data.frame(Category = names(.), session_info = .)
rownames(sys1) <- NULL
sys1 %>% formattable %>% as.htmlwidget

data.frame(Sys.info()) %>% mutate(Category = rownames(.)) %>% .[2:1] %>% rename(Category = Category, Sys.info =  Sys.info..) %>% formattable %>% as.htmlwidget

rm(sys1)
```

## 7.2 Reference

  01. [<span style='color:blue'>Binary.com Interview Q1</span>](https://englianhu.github.io/2017/09/binary-forex-trading-Q1.html)([Alternate link](http://rpubs.com/englianhu/binary-forex-trading-Q1)) <img src='https://raw.githubusercontent.com/englianhu/binary.com-interview-question/master/www/hot.jpg?raw=true' width='20'>

**Powered by - Copyright® Intellectual Property Rights of <img src='https://raw.githubusercontent.com/englianhu/binary.com-interview-question/master/www/oda-army2.jpg?raw=true' width='24'> [<span style='color:blue'>Scibrokes®</span>](http://www.scibrokes.com)個人の経営企業**
